<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroAI | Когнитивная диагностика и реабилитация</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --medical-blue: #1a3a5f;
            --medical-light-blue: #2c5a8a;
            --medical-cyan: #0d98ba;
            --medical-green: #2ecc71;
            --medical-red: #e74c3c;
            --medical-yellow: #f39c12;
            --medical-purple: #9b59b6;
            --medical-gray: #95a5a6;
            --medical-light: #ecf0f1;
            --medical-dark: #2c3e50;
            
            --gradient-medical: linear-gradient(135deg, #1a3a5f 0%, #0d98ba 100%);
            --gradient-success: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            --gradient-warning: linear-gradient(135deg, #e67e22 0%, #f39c12 100%);
            --gradient-danger: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
            --gradient-purple: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-heavy: 0 8px 30px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Roboto', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e8f4fd 100%);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
            padding-top: 80px; /* Для фиксированного хедера */
        }

        .container {
            width: 90%;
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header - Медицинский дизайн */
        header {
            background: white;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: var(--shadow);
            border-bottom: 3px solid var(--medical-cyan);
            padding: 10px 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
            color: var(--medical-blue);
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-medical);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
            box-shadow: 0 4px 15px rgba(26, 58, 95, 0.3);
        }

        .logo-text h1 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800;
            font-size: 1.8rem;
            background: var(--gradient-medical);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-text p {
            font-size: 0.9rem;
            color: var(--medical-gray);
            font-weight: 500;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            color: var(--medical-blue);
            text-decoration: none;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            padding: 10px 20px;
            border-radius: 25px;
            transition: var(--transition);
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        nav a:hover {
            background: rgba(13, 152, 186, 0.1);
            color: var(--medical-cyan);
        }

        nav a.active {
            background: var(--medical-cyan);
            color: white;
            box-shadow: 0 4px 15px rgba(13, 152, 186, 0.3);
        }

        .nav-notification {
            position: absolute;
            top: -5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background: var(--medical-red);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 28px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--gradient-medical);
            color: white;
            box-shadow: 0 4px 15px rgba(13, 152, 186, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--medical-blue);
            border: 2px solid var(--medical-blue);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }

        .btn-warning {
            background: var(--gradient-warning);
            color: white;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }

        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .btn-purple {
            background: var(--gradient-purple);
            color: white;
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Hero Section - Медицинский */
        .hero {
            padding: 100px 0 80px;
            background: linear-gradient(135deg, rgba(26, 58, 95, 0.95) 0%, rgba(13, 152, 186, 0.95) 100%), 
                        url('https://images.unsplash.com/photo-1559757148-5c350d0d3c56?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            position: relative;
            overflow: hidden;
            margin-top: -80px;
        }

        .hero:before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100px;
            background: linear-gradient(to bottom, transparent 0%, #f8fafc 100%);
        }

        .hero-content {
            position: relative;
            z-index: 1;
            max-width: 800px;
        }

        .hero h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 3.2rem;
            font-weight: 800;
            margin-bottom: 25px;
            line-height: 1.2;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 35px;
            opacity: 0.9;
            max-width: 600px;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-top: 60px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .hero-stat {
            text-align: center;
        }

        .hero-stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            margin-bottom: 5px;
        }

        .hero-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Main Content */
        .main-content {
            padding: 80px 0;
        }

        .section {
            padding: 80px 0;
            scroll-margin-top: 100px;
        }

        .section-title {
            text-align: center;
            margin-bottom: 60px;
            position: relative;
        }

        .section-title h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--medical-blue);
            margin-bottom: 15px;
        }

        .section-title p {
            color: var(--medical-gray);
            font-size: 1.1rem;
            max-width: 700px;
            margin: 0 auto;
        }

        .title-decoration {
            width: 100px;
            height: 4px;
            background: var(--gradient-medical);
            margin: 20px auto;
            border-radius: 2px;
        }

        /* AI Dashboard - Медицинский стиль */
        .ai-dashboard {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: var(--shadow-heavy);
            margin-bottom: 50px;
            border: 1px solid rgba(13, 152, 186, 0.1);
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 2px solid #f0f4f8;
        }

        .dashboard-header h3 {
            font-family: 'Montserrat', sans-serif;
            color: var(--medical-blue);
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 50px;
            margin-top: 30px;
        }

        @media (max-width: 1100px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Age Selector */
        .age-selector {
            background: linear-gradient(135deg, #f8fafc 0%, #e8f4fd 100%);
            border-radius: 20px;
            padding: 30px;
            height: fit-content;
            border: 2px solid #e8f4fd;
        }

        .age-selector h4 {
            color: var(--medical-blue);
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .age-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .age-btn {
            padding: 20px;
            background: white;
            border: 2px solid #e0e6ed;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: left;
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--medical-blue);
        }

        .age-btn:hover {
            border-color: var(--medical-cyan);
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(13, 152, 186, 0.1);
        }

        .age-btn.active {
            border-color: var(--medical-cyan);
            background: linear-gradient(135deg, rgba(13, 152, 186, 0.1) 0%, rgba(26, 58, 95, 0.05) 100%);
            box-shadow: 0 5px 20px rgba(13, 152, 186, 0.15);
        }

        .age-btn i {
            color: var(--medical-cyan);
            font-size: 1.3rem;
            width: 40px;
            height: 40px;
            background: rgba(13, 152, 186, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .age-btn .test-count {
            margin-left: auto;
            background: var(--medical-cyan);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        /* Tests Table - Улучшенный дизайн */
        .tests-section {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .tests-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .tests-table-container {
            overflow-x: auto;
            border-radius: 15px;
            border: 1px solid #e8f4fd;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .tests-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            min-width: 800px;
        }

        .tests-table thead {
            background: var(--gradient-medical);
        }

        .tests-table th {
            color: white;
            padding: 18px 15px;
            text-align: left;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            position: relative;
        }

        .tests-table th:after {
            content: '';
            position: absolute;
            right: 0;
            top: 25%;
            height: 50%;
            width: 1px;
            background: rgba(255, 255, 255, 0.3);
        }

        .tests-table th:last-child:after {
            display: none;
        }

        .tests-table td {
            padding: 18px 15px;
            border-bottom: 1px solid #f0f4f8;
            color: #555;
        }

        .tests-table tr:hover {
            background-color: #f8fafc;
        }

        .tests-table tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .test-name {
            font-weight: 600;
            color: var(--medical-blue);
        }

        .result-input {
            width: 120px;
            padding: 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
            text-align: center;
            transition: var(--transition);
            font-weight: 500;
        }

        .result-input:focus {
            border-color: var(--medical-cyan);
            outline: none;
            box-shadow: 0 0 0 3px rgba(13, 152, 186, 0.2);
        }

        .category-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            min-width: 120px;
            justify-content: center;
        }

        .category-normal {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.15) 0%, rgba(39, 174, 96, 0.15) 100%);
            color: var(--medical-green);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        .category-risk {
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.15) 0%, rgba(230, 126, 34, 0.15) 100%);
            color: var(--medical-yellow);
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .category-deviation {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.15) 0%, rgba(192, 57, 43, 0.15) 100%);
            color: var(--medical-red);
            border: 1px solid rgba(231, 76, 60, 0.3);
        }

        .category-waiting {
            background: #f8f9fa;
            color: var(--medical-gray);
            border: 1px solid #e0e0e0;
        }

        /* AI Analysis */
        .ai-analysis-container {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: var(--shadow-heavy);
            margin-top: 50px;
            border: 1px solid rgba(13, 152, 186, 0.1);
            display: none;
        }

        .analysis-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 2px solid #f0f4f8;
        }

        .overall-score {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .score-circle {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 800;
            position: relative;
        }

        .score-circle.normal {
            background: conic-gradient(var(--medical-green) 0% 80%, #f0f4f8 80% 100%);
            color: var(--medical-green);
        }

        .score-circle.risk {
            background: conic-gradient(var(--medical-yellow) 0% 60%, #f0f4f8 60% 100%);
            color: var(--medical-yellow);
        }

        .score-circle.deviation {
            background: conic-gradient(var(--medical-red) 0% 40%, #f0f4f8 40% 100%);
            color: var(--medical-red);
        }

        .score-circle span {
            position: absolute;
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-recommendation {
            background: linear-gradient(135deg, rgba(13, 152, 186, 0.05) 0%, rgba(26, 58, 95, 0.05) 100%);
            border-radius: 20px;
            padding: 35px;
            margin-top: 30px;
            border-left: 5px solid var(--medical-cyan);
        }

        .ai-recommendation h4 {
            color: var(--medical-blue);
            margin-bottom: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ai-recommendation ul {
            list-style: none;
            margin-left: 0;
        }

        .ai-recommendation li {
            padding: 12px 0;
            border-bottom: 1px dashed #d1e0ee;
            position: relative;
            padding-left: 40px;
            color: #555;
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .ai-recommendation li:before {
            content: '✓';
            position: absolute;
            left: 0;
            color: var(--medical-green);
            font-weight: bold;
            font-size: 1.3rem;
        }

        /* Games Section - Медицинский дизайн */
        .games-section {
            background: white;
            border-radius: 25px;
            padding: 50px 40px;
            margin: 50px 0;
            box-shadow: var(--shadow-heavy);
            border: 1px solid rgba(13, 152, 186, 0.1);
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 35px;
            margin-top: 40px;
        }

        .game-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e8f4fd 100%);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
        }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            border-color: var(--medical-cyan);
        }

        .game-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--medical-red);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1;
        }

        .game-header {
            background: var(--gradient-medical);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .game-header h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .game-body {
            padding: 30px;
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e8f4fd;
        }

        .game-stat {
            text-align: center;
        }

        .game-stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--medical-blue);
            margin-bottom: 5px;
        }

        .game-stat-label {
            font-size: 0.9rem;
            color: var(--medical-gray);
            font-weight: 500;
        }

        /* Game Screens */
        .game-screen {
            display: none;
            text-align: center;
        }

        .game-screen.active {
            display: block;
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 25px auto;
            max-width: 450px;
        }

        .memory-card {
            aspect-ratio: 1;
            background: var(--gradient-medical);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            user-select: none;
            position: relative;
            transform-style: preserve-3d;
        }

        .memory-card.flipped {
            background: white;
            color: var(--medical-blue);
            border: 3px solid var(--medical-cyan);
            transform: rotateY(180deg);
        }

        .memory-card.matched {
            background: var(--gradient-success);
            color: white;
            transform: scale(0.95) rotateY(180deg);
            border-color: var(--medical-green);
        }

        .reaction-test {
            padding: 35px;
            background: linear-gradient(135deg, #f8fafc 0%, #e8f4fd 100%);
            border-radius: 20px;
            margin: 25px 0;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .reaction-target {
            width: 150px;
            height: 150px;
            background: var(--gradient-purple);
            border-radius: 50%;
            margin: 20px auto;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.3rem;
            transition: var(--transition);
            box-shadow: 0 10px 30px rgba(155, 89, 182, 0.3);
        }

        .reaction-target.active {
            background: var(--gradient-success);
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(46, 204, 113, 0.4);
        }

        .reaction-target.clicked {
            background: var(--gradient-danger);
            transform: scale(0.95);
        }

        .attention-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin: 25px auto;
            max-width: 550px;
        }

        .attention-cell {
            aspect-ratio: 1;
            background: #e0e6ed;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition);
            border: 3px solid transparent;
        }

        .attention-cell.target {
            background: var(--gradient-medical);
            color: white;
            border-color: var(--medical-cyan);
            box-shadow: 0 5px 15px rgba(13, 152, 186, 0.3);
        }

        .attention-cell.clicked {
            background: var(--gradient-success);
            color: white;
            transform: scale(0.95);
        }

        .attention-cell.wrong {
            background: var(--gradient-danger);
            color: white;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Auth Forms */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .auth-content {
            background: white;
            border-radius: 25px;
            padding: 50px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--medical-cyan);
            position: relative;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 40px;
            border-bottom: 2px solid #f0f4f8;
            padding-bottom: 20px;
        }

        .auth-tab {
            padding: 15px 30px;
            background: none;
            border: none;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--medical-gray);
            cursor: pointer;
            transition: var(--transition);
            border-radius: 10px;
        }

        .auth-tab.active {
            background: var(--gradient-medical);
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--medical-blue);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e0e6ed;
            border-radius: 12px;
            font-size: 1rem;
            transition: var(--transition);
            font-family: 'Roboto', sans-serif;
        }

        .form-control:focus {
            border-color: var(--medical-cyan);
            outline: none;
            box-shadow: 0 0 0 3px rgba(13, 152, 186, 0.2);
        }

        .close-auth {
            position: absolute;
            top: 25px;
            right: 25px;
            background: none;
            border: none;
            font-size: 1.8rem;
            color: var(--medical-gray);
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-auth:hover {
            background: rgba(13, 152, 186, 0.1);
            color: var(--medical-red);
            transform: rotate(90deg);
        }

        /* AI Assistant Chat */
        .ai-assistant {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }

        .chat-toggle {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--gradient-medical);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.8rem;
            box-shadow: 0 10px 30px rgba(13, 152, 186, 0.4);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 15px 40px rgba(13, 152, 186, 0.6);
        }

        .chat-toggle .notification {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 12px;
            height: 12px;
            background: var(--medical-red);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .chat-window {
            position: absolute;
            bottom: 90px;
            right: 0;
            width: 380px;
            height: 550px;
            background: white;
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 2px solid var(--medical-cyan);
        }

        .chat-window.active {
            display: flex;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .chat-header {
            background: var(--gradient-medical);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header h4 {
            display: flex;
            align-items: center;
            gap: 15px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2rem;
        }

        .close-chat {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .close-chat:hover {
            transform: rotate(90deg);
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #f8fafc;
        }

        .message {
            max-width: 80%;
            padding: 15px 18px;
            border-radius: 20px;
            line-height: 1.5;
            position: relative;
        }

        .message.user {
            align-self: flex-end;
            background: var(--gradient-medical);
            color: white;
            border-bottom-right-radius: 5px;
            box-shadow: 0 4px 15px rgba(13, 152, 186, 0.2);
        }

        .message.ai {
            align-self: flex-start;
            background: white;
            color: var(--medical-blue);
            border-bottom-left-radius: 5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #e8f4fd;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }

        .chat-input {
            padding: 18px;
            border-top: 2px solid #e8f4fd;
            display: flex;
            gap: 15px;
            background: white;
        }

        .chat-input input {
            flex: 1;
            padding: 14px 18px;
            border: 2px solid #e0e6ed;
            border-radius: 25px;
            outline: none;
            font-size: 1rem;
            transition: var(--transition);
        }

        .chat-input input:focus {
            border-color: var(--medical-cyan);
            box-shadow: 0 0 0 3px rgba(13, 152, 186, 0.1);
        }

        .send-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gradient-medical);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .send-btn:hover {
            transform: scale(1.1);
        }

        /* NEW FEATURES */

        /* Progress Dashboard */
        .progress-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .progress-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            border-top: 5px solid var(--medical-cyan);
        }

        .progress-card h4 {
            color: var(--medical-blue);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .progress-stat {
            text-align: center;
        }

        .progress-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--medical-blue);
        }

        .progress-label {
            color: var(--medical-gray);
            font-size: 0.9rem;
        }

        /* Medical Calendar */
        .medical-calendar {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-top: 40px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            background: #f8fafc;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .calendar-day:hover {
            background: #e8f4fd;
        }

        .calendar-day.active {
            background: var(--medical-cyan);
            color: white;
        }

        .calendar-day.appointment {
            position: relative;
        }

        .calendar-day.appointment:after {
            content: '';
            position: absolute;
            bottom: 5px;
            width: 6px;
            height: 6px;
            background: var(--medical-red);
            border-radius: 50%;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        /* Modal Windows */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 25px;
            padding: 40px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
            border: 2px solid var(--medical-cyan);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 2px solid #f0f4f8;
        }

        .modal-header h3 {
            color: var(--medical-blue);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--medical-gray);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--medical-red);
            transform: rotate(90deg);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 50px;
            display: none;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 5px solid rgba(13, 152, 186, 0.1);
            border-left-color: var(--medical-cyan);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 30px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        footer {
            background: var(--medical-blue);
            color: white;
            padding: 70px 0 35px;
            position: relative;
            overflow: hidden;
        }

        footer:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--gradient-medical);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 50px;
            margin-bottom: 50px;
        }

        .footer-logo {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .footer-links h4 {
            margin-bottom: 25px;
            color: white;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2rem;
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 15px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-links a:hover {
            color: white;
            transform: translateX(5px);
        }

        .contact-info {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 15px;
            color: rgba(255, 255, 255, 0.9);
        }

        .contact-item i {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-link {
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            transition: var(--transition);
        }

        .social-link:hover {
            background: var(--medical-cyan);
            transform: translateY(-5px);
        }

        .copyright {
            text-align: center;
            padding-top: 35px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }

        /* Quick Actions */
        .quick-actions {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 999;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .quick-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: white;
            color: var(--medical-blue);
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quick-btn:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }

        .quick-btn.emergency {
            background: var(--gradient-danger);
            color: white;
            animation: emergencyPulse 2s infinite;
        }

        @keyframes emergencyPulse {
            0% { box-shadow: 0 10px 30px rgba(231, 76, 60, 0.4); }
            50% { box-shadow: 0 10px 40px rgba(231, 76, 60, 0.7); }
            100% { box-shadow: 0 10px 30px rgba(231, 76, 60, 0.4); }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .hero h1 {
                font-size: 2.8rem;
            }
            
            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 992px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
                padding: 15px 0;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }
            
            .auth-buttons {
                margin-top: 10px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding-top: 140px;
            }
            
            .hero {
                padding: 120px 0 60px;
                margin-top: -140px;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .section-title h2 {
                font-size: 2rem;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .ai-dashboard, .ai-analysis-container, .games-section {
                padding: 25px 20px;
            }
            
            .auth-content {
                padding: 30px 20px;
            }
            
            .chat-window {
                width: 90vw;
                right: 5vw;
            }
            
            .quick-actions {
                left: 20px;
                bottom: 20px;
            }
            
            .ai-assistant {
                right: 20px;
                bottom: 20px;
            }
            
            .hero-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .hero h1 {
                font-size: 1.8rem;
            }
            
            .section-title h2 {
                font-size: 1.6rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .memory-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .attention-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 10px;
            }
            
            .reaction-target {
                width: 120px;
                height: 120px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <a href="#home" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="logo-text">
                    <h1>NeuroAI</h1>
                    <p>Когнитивная диагностика и реабилитация</p>
                </div>
            </a>
            <nav>
                <ul>
                    <li>
                        <a href="#home" class="nav-link active">
                            <i class="fas fa-home"></i> Главная
                        </a>
                    </li>
                    <li>
                        <a href="#ai-diagnostic" class="nav-link">
                            <i class="fas fa-stethoscope"></i> Диагностика
                            <span class="nav-notification"></span>
                        </a>
                    </li>
                    <li>
                        <a href="#games" class="nav-link">
                            <i class="fas fa-gamepad"></i> Тренировки
                        </a>
                    </li>
                    <li>
                        <a href="#progress" class="nav-link">
                            <i class="fas fa-chart-line"></i> Прогресс
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <button id="loginBtn" class="btn btn-secondary">
                    <i class="fas fa-sign-in-alt"></i> Войти
                </button>
                <button id="registerBtn" class="btn btn-primary">
                    <i class="fas fa-user-plus"></i> Регистрация
                </button>
            </div>
        </div>
    </header>

    <section class="hero" id="home">
        <div class="container hero-content">
            <h1>Интеллектуальная система когнитивной диагностики NeuroAI</h1>
            <p>Профессиональные нейропсихологические тесты и персонализированные программы реабилитации для детей и подростков</p>
            
            <div class="hero-buttons">
                <button id="startAiDiagnosticBtn" class="btn btn-success">
                    <i class="fas fa-robot"></i> Начать диагностику
                </button>
                <button id="playGamesBtn" class="btn btn-purple">
                    <i class="fas fa-brain"></i> Тренировать когнитивные функции
                </button>
                <button id="emergencyBtn" class="btn btn-danger">
                    <i class="fas fa-phone-alt"></i> Срочная консультация
                </button>
            </div>
            
            <div class="hero-stats">
                <div class="hero-stat">
                    <div class="hero-stat-value">1,250+</div>
                    <div class="hero-stat-label">Успешных диагностик</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value">98%</div>
                    <div class="hero-stat-label">Точность анализа</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value">27</div>
                    <div class="hero-stat-label">Профессиональных тестов</div>
                </div>
                <div class="hero-stat">
                    <div class="hero-stat-value">24/7</div>
                    <div class="hero-stat-label">Поддержка специалистов</div>
                </div>
            </div>
        </div>
    </section>

    <main class="container main-content">
        <!-- ИИ-Диагностика -->
        <section class="section" id="ai-diagnostic">
            <div class="section-title">
                <h2><i class="fas fa-stethoscope"></i> ИИ-Диагностика когнитивных функций</h2>
                <p>Точная оценка памяти, внимания, мышления и других когнитивных функций с использованием международных нейропсихологических тестов</p>
                <div class="title-decoration"></div>
            </div>
            
            <div class="ai-dashboard">
                <div class="dashboard-header">
                    <h3><i class="fas fa-user-md"></i> Выберите возраст пациента</h3>
                    <div class="btn btn-warning" onclick="showMedicalHelp()">
                        <i class="fas fa-question-circle"></i> Помощь в заполнении
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="age-selector">
                        <h4><i class="fas fa-child"></i> Возрастные группы</h4>
                        <p style="color: var(--medical-gray); margin-bottom: 20px;">Выберите возраст для подбора соответствующих тестов</p>
                        
                        <div class="age-buttons">
                            <button class="age-btn" data-age="0">
                                <i class="fas fa-baby"></i>
                                <span>0-4 года</span>
                                <span class="test-count">4 теста</span>
                            </button>
                            <button class="age-btn" data-age="5">
                                <i class="fas fa-child"></i>
                                <span>5-9 лет</span>
                                <span class="test-count">6 тестов</span>
                            </button>
                            <button class="age-btn" data-age="10">
                                <i class="fas fa-user"></i>
                                <span>10-14 лет</span>
                                <span class="test-count">8 тестов</span>
                            </button>
                            <button class="age-btn" data-age="15">
                                <i class="fas fa-user-graduate"></i>
                                <span>15-17 лет</span>
                                <span class="test-count">7 тестов</span>
                            </button>
                            <button class="age-btn active" data-age="18">
                                <i class="fas fa-user-tie"></i>
                                <span>18+ лет</span>
                                <span class="test-count">9 тестов</span>
                            </button>
                        </div>
                        
                        <div style="margin-top: 40px;">
                            <button id="analyzeBtn" class="btn btn-success" style="width: 100%; padding: 16px;">
                                <i class="fas fa-brain"></i> Анализировать результаты
                            </button>
                            <button id="saveResultsBtn" class="btn btn-secondary" style="width: 100%; margin-top: 12px; padding: 16px;">
                                <i class="fas fa-save"></i> Сохранить результаты
                            </button>
                            <button id="createPlanBtn" class="btn btn-primary" style="width: 100%; margin-top: 12px; padding: 16px;">
                                <i class="fas fa-calendar-check"></i> Создать план реабилитации
                            </button>
                        </div>
                    </div>
                    
                    <div class="tests-section">
                        <div class="tests-header">
                            <h4 style="color: var(--medical-blue);">
                                <i class="fas fa-clipboard-list"></i> Результаты нейропсихологических тестов
                            </h4>
                            <div class="btn btn-secondary" onclick="autoFillSample()">
                                <i class="fas fa-magic"></i> Заполнить образец
                            </div>
                        </div>
                        
                        <div class="tests-table-container">
                            <table class="tests-table" id="testsTable">
                                <thead>
                                    <tr>
                                        <th width="50">№</th>
                                        <th>Тест</th>
                                        <th>Область оценки</th>
                                        <th>Ваш результат</th>
                                        <th>Оценка ИИ</th>
                                    </tr>
                                </thead>
                                <tbody id="testsTableBody">
                                    <!-- Тесты будут загружены динамически -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="loading" id="analysisLoading">
                            <div class="spinner"></div>
                            <p style="color: var(--medical-blue); font-size: 1.1rem; margin-top: 20px;">
                                <i class="fas fa-robot"></i> ИИ анализирует результаты... Пожалуйста, подождите.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="ai-analysis-container" id="aiAnalysis">
                <div class="analysis-header">
                    <div>
                        <h3 style="color: var(--medical-blue);">
                            <i class="fas fa-robot"></i> Результаты ИИ-анализа
                        </h3>
                        <p style="color: var(--medical-gray); margin-top: 10px;">На основе международных норм и нейропсихологических стандартов</p>
                    </div>
                    <div class="overall-score">
                        <div class="score-circle normal" id="overallScoreCircle">
                            <span>82%</span>
                        </div>
                        <div>
                            <h4 style="color: var(--medical-blue);">Общий результат</h4>
                            <div class="category-indicator category-normal" id="overallCategory">
                                <i class="fas fa-check-circle"></i> Норма
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="categorySummary" style="margin-bottom: 40px;">
                    <!-- Сводка по категориям будет здесь -->
                </div>
                
                <div class="ai-recommendation">
                    <h4><i class="fas fa-comment-medical"></i> Рекомендации нейропсихолога</h4>
                    <div id="aiRecommendationText">
                        <!-- Рекомендации ИИ будут здесь -->
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="openAppointmentModal('neuropsychologist')">
                        <i class="fas fa-calendar-alt"></i> Запись к нейропсихологу
                    </button>
                    <button class="btn btn-primary" onclick="createRehabilitationPlan()">
                        <i class="fas fa-tasks"></i> Создать план реабилитации
                    </button>
                    <button class="btn btn-purple" onclick="downloadMedicalReport()">
                        <i class="fas fa-file-medical"></i> Скачать медицинское заключение
                    </button>
                </div>
            </div>
        </section>

        <!-- Когнитивные тренировки -->
        <section class="section" id="games">
            <div class="section-title">
                <h2><i class="fas fa-brain"></i> Когнитивные тренировки</h2>
                <p>Интерактивные игры для развития памяти, внимания, скорости реакции и других когнитивных функций</p>
                <div class="title-decoration"></div>
            </div>
            
            <div class="games-section">
                <div class="games-grid">
                    <!-- Игра 1: Тренировка памяти -->
                    <div class="game-card">
                        <div class="game-badge">Рекомендовано</div>
                        <div class="game-header">
                            <h3><i class="fas fa-memory"></i> Когнитивная память</h3>
                            <p>Развитие зрительной и пространственной памяти</p>
                        </div>
                        <div class="game-body">
                            <div class="game-stats">
                                <div class="game-stat">
                                    <div class="game-stat-value" id="memoryScore">0</div>
                                    <div class="game-stat-label">Очки</div>
                                </div>
                                <div class="game-stat">
                                    <div class="game-stat-value" id="memoryTime">60</div>
                                    <div class="game-stat-label">Секунды</div>
                                </div>
                                <div class="game-stat">
                                    <div class="game-stat-value" id="memoryLevel">1</div>
                                    <div class="game-stat-label">Уровень</div>
                                </div>
                            </div>
                            
                            <div class="game-screen active" id="memoryStartScreen">
                                <p style="color: var(--medical-gray); margin-bottom: 25px;">Найдите все пары карточек для улучшения зрительной памяти</p>
                                <button class="btn btn-primary" onclick="startMemoryGame()" style="width: 100%; padding: 16px;">
                                    <i class="fas fa-play"></i> Начать тренировку памяти
                                </button>
                            </div>
                            
                            <div class="game-screen" id="memoryGameScreen">
                                <div class="memory-grid" id="memoryGrid">
                                    <!-- Карточки будут созданы динамически -->
                                </div>
                                <div style="margin-top: 25px; display: flex; gap: 15px; justify-content: center;">
                                    <button class="btn btn-secondary" onclick="pauseMemoryGame()">
                                        <i class="fas fa-pause"></i> Пауза
                                    </button>
                                    <button class="btn btn-danger" onclick="endMemoryGame()">
                                        <i class="fas fa-stop"></i> Завершить
                                    </button>
                                </div>
                            </div>
                            
                            <div class="game-screen" id="memoryResultScreen">
                                <div style="background: linear-gradient(135deg, #f8fafc 0%, #e8f4fd 100%); border-radius: 15px; padding: 25px;">
                                    <h4 style="color: var(--medical-blue); margin-bottom: 15px;">Результаты тренировки</h4>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                                        <div>
                                            <p style="color: var(--medical-gray); font-size: 0.9rem;">Найдено пар</p>
                                            <p style="font-size: 1.5rem; font-weight: 600; color: var(--medical-blue);">
                                                <span id="memoryPairsFound">0</span>/<span id="memoryTotalPairs">0</span>
                                            </p>
                                        </div>
                                        <div>
                                            <p style="color: var(--medical-gray); font-size: 0.9rem;">Оставшееся время</p>
                                            <p style="font-size: 1.5rem; font-weight: 600; color: var(--medical-blue);">
                                                <span id="memoryTimeLeft">0</span> сек
                                            </p>
                                        </div>
                                    </div>
                                    <div class="category-indicator category-normal" id="memoryResultBadge" style="margin-bottom: 20px;">Отлично!</div>
                                    <button class="btn btn-primary" onclick="startMemoryGame()" style="width: 100%;">
                                        <i class="fas fa-redo"></i> Повторить тренировку
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Игра 2: Скорость реакции -->
                    <div class="game-card">
                        <div class="game-header">
                            <h3><i class="fas fa-bolt"></i> Скорость реакции</h3>
                            <p>Тест и тренировка скорости психомоторной реакции</p>
                        </div>
                        <div class="game-body">
                            <div class="game-stats">
                                <div class="game-stat">
                                    <div class="game-stat-value" id="reactionScore">0</div>
                                    <div class="game-stat-label">Очки</div>
                                </div>
                                <div class="game-stat">
                                    <div class="game-stat-value" id="reactionAvg">0</div>
                                    <div class="game-stat-label">Мс</div>
                                </div>
                                <div class="game-stat">
                                    <div class="game-stat-value" id="reactionRound">0</div>
                                    <div class="game-stat-label">Раунд</div>
                                </div>
                            </div>
                            
                            <div class="game-screen active" id="reactionStartScreen">
                                <p style="color: var(--medical-gray); margin-bottom: 25px;">Нажмите на мишень при изменении цвета для тренировки скорости реакции</p>
                                <button class="btn btn-primary" onclick="startReactionTest()" style="width: 100%; padding: 16px;">
                                    <i class="fas fa-play"></i> Начать тест реакции
                                </button>
                            </div>
                            
                            <div class="game-screen" id="reactionGameScreen">
                                <div class="reaction-test">
                                    <p style="color: var(--medical-blue); font-weight: 600; margin-bottom: 20px;">Нажмите, когда мишень станет зеленой!</p>
                                    <p style="color: var(--medical-gray); margin-bottom: 10px;">Средняя реакция: <span style="color: var(--medical-blue); font-weight: 600;" id="reactionTimeDisplay">0</span> мс</p>
                                    <div class="reaction-target" id="reactionTarget" onclick="handleReactionClick()">
                                        ЖДИТЕ...
                                    </div>
                                    <p style="color: var(--medical-gray); margin-top: 20px;">Раунд: <span style="color: var(--medical-blue); font-weight: 600;" id="reactionRoundDisplay">1</span>/10</p>
                                </div>
                            </div>
                            
                            <div class="game-screen" id="reactionResultScreen">
                                <div style="background: linear-gradient(135deg, #f8fafc 0%, #e8f4fd 100%); border-radius: 15px; padding: 25px;">
                                    <h4 style="color: var(--medical-blue); margin-bottom: 15px;">Результаты теста реакции</h4>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                                        <div>
                                            <p style="color: var(--medical-gray); font-size: 0.9rem;">Средняя реакция</p>
                                            <p style="font-size: 1.5rem; font-weight: 600; color: var(--medical-blue);">
                                                <span id="avgReactionResult">0</span> мс
                                            </p>
                                        </div>
                                        <div>
                                            <p style="color: var(--medical-gray); font-size: 0.9rem;">Лучший результат</p>
                                            <p style="font-size: 1.5rem; font-weight: 600; color: var(--medical-blue);">
                                                <span id="bestReactionResult">0</span> мс
                                            </p>
                                        </div>
                                    </div>
                                    <div class="category-indicator category-normal" id="reactionResultBadge" style="margin-bottom: 20px;">Хорошо!</div>
                                    <button class="btn btn-primary" onclick="startReactionTest()" style="width: 100%;">
                                        <i class="fas fa-redo"></i> Повторить тест
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Игра 3: Внимание -->
                    <div class="game-card">
                        <div class="game-badge">Новое</div>
                        <div class="game-header">
                            <h3><i class="fas fa-eye"></i> Концентрация внимания</h3>
                            <p>Тренировка избирательного и устойчивого внимания</p>
                        </div>
                        <div class="game-body">
                            <div class="game-stats">
                                <div class="game-stat">
                                    <div class="game-stat-value" id="attentionScore">0</div>
                                    <div class="game-stat-label">Очки</div>
                                </div>
                                <div class="game-stat">
                                    <div class="game-stat-value" id="attentionAccuracy">0</div>
                                    <div class="game-stat-label">% точности</div>
                                </div>
                                <div class="game-stat">
                                    <div class="game-stat-value" id="attentionLevel">1</div>
                                    <div class="game-stat-label">Уровень</div>
                                </div>
                            </div>
                            
                            <div class="game-screen active" id="attentionStartScreen">
                                <p style="color: var(--medical-gray); margin-bottom: 25px;">Найдите все мишени для тренировки концентрации внимания</p>
                                <button class="btn btn-primary" onclick="startAttentionTest()" style="width: 100%; padding: 16px;">
                                    <i class="fas fa-play"></i> Начать тренировку внимания
                                </button>
                            </div>
                            
                            <div class="game-screen" id="attentionGameScreen">
                                <p style="color: var(--medical-blue); font-weight: 600; margin-bottom: 15px;">Найдите <span id="attentionTargetCount">3</span> мишени</p>
                                <div class="attention-grid" id="attentionGrid">
                                    <!-- Клетки будут созданы динамически -->
                                </div>
                                <div style="margin-top: 25px; background: #f8fafc; padding: 15px; border-radius: 10px;">
                                    <p style="color: var(--medical-gray); margin: 0;">
                                        Время: <span style="color: var(--medical-blue); font-weight: 600;" id="attentionTimeLeft">30</span> сек | 
                                        Найдено: <span style="color: var(--medical-blue); font-weight: 600;" id="attentionFound">0</span>/<span id="attentionTotalTargets">3</span>
                                    </p>
                                </div>
                            </div>
                            
                            <div class="game-screen" id="attentionResultScreen">
                                <div style="background: linear-gradient(135deg, #f8fafc 0%, #e8f4fd 100%); border-radius: 15px; padding: 25px;">
                                    <h4 style="color: var(--medical-blue); margin-bottom: 15px;">Результаты тренировки внимания</h4>
                                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                                        <div>
                                            <p style="color: var(--medical-gray); font-size: 0.9rem;">Точность</p>
                                            <p style="font-size: 1.5rem; font-weight: 600; color: var(--medical-blue);">
                                                <span id="attentionAccuracyResult">0</span>%
                                            </p>
                                        </div>
                                        <div>
                                            <p style="color: var(--medical-gray); font-size: 0.9rem;">Время</p>
                                            <p style="font-size: 1.5rem; font-weight: 600; color: var(--medical-blue);">
                                                <span id="attentionTimeResult">0</span> сек
                                            </p>
                                        </div>
                                    </div>
                                    <div class="category-indicator category-normal" id="attentionResultBadge" style="margin-bottom: 20px;">Хорошо!</div>
                                    <button class="btn btn-primary" onclick="startAttentionTest()" style="width: 100%;">
                                        <i class="fas fa-redo"></i> Повторить тренировку
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Прогресс тренировок -->
                <div style="margin-top: 60px;">
                    <h4 style="color: var(--medical-blue); text-align: center; margin-bottom: 30px; font-family: 'Montserrat', sans-serif;">
                        <i class="fas fa-chart-line"></i> Динамика когнитивного прогресса
                    </h4>
                    <div class="progress-dashboard">
                        <div class="progress-card">
                            <h4><i class="fas fa-memory"></i> Память</h4>
                            <div class="progress-stats">
                                <div class="progress-stat">
                                    <div class="progress-number" id="memoryProgress">0</div>
                                    <div class="progress-label">Прогресс</div>
                                </div>
                                <div class="progress-stat">
                                    <div class="progress-number" id="memorySessions">0</div>
                                    <div class="progress-label">Тренировок</div>
                                </div>
                            </div>
                            <div class="progress-bar" style="margin-top: 20px;">
                                <div class="progress-fill" id="memoryProgressBar" style="width: 0%; background: var(--gradient-medical);"></div>
                            </div>
                        </div>
                        
                        <div class="progress-card">
                            <h4><i class="fas fa-bolt"></i> Реакция</h4>
                            <div class="progress-stats">
                                <div class="progress-stat">
                                    <div class="progress-number" id="reactionProgress">0</div>
                                    <div class="progress-label">Прогресс</div>
                                </div>
                                <div class="progress-stat">
                                    <div class="progress-number" id="reactionSessions">0</div>
                                    <div class="progress-label">Тренировок</div>
                                </div>
                            </div>
                            <div class="progress-bar" style="margin-top: 20px;">
                                <div class="progress-fill" id="reactionProgressBar" style="width: 0%; background: var(--gradient-purple);"></div>
                            </div>
                        </div>
                        
                        <div class="progress-card">
                            <h4><i class="fas fa-eye"></i> Внимание</h4>
                            <div class="progress-stats">
                                <div class="progress-stat">
                                    <div class="progress-number" id="attentionProgress">0</div>
                                    <div class="progress-label">Прогресс</div>
                                </div>
                                <div class="progress-stat">
                                    <div class="progress-number" id="attentionSessions">0</div>
                                    <div class="progress-label">Тренировок</div>
                                </div>
                            </div>
                            <div class="progress-bar" style="margin-top: 20px;">
                                <div class="progress-fill" id="attentionProgressBar" style="width: 0%; background: var(--gradient-success);"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Дополнительные функции -->
        <section class="section" id="progress">
            <div class="section-title">
                <h2><i class="fas fa-chart-line"></i> Дополнительные возможности</h2>
                <p>Комплексный подход к когнитивному развитию и реабилитации</p>
                <div class="title-decoration"></div>
            </div>
            
            <div class="progress-dashboard">
                <div class="progress-card">
                    <h4><i class="fas fa-calendar-alt"></i> Медицинский календарь</h4>
                    <div class="medical-calendar">
                        <div class="calendar-header">
                            <h5 style="color: var(--medical-blue);">Ноябрь 2023</h5>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-secondary" style="padding: 8px 15px;">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button class="btn btn-secondary" style="padding: 8px 15px;">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div class="calendar-grid">
                            <div class="calendar-day">Пн</div>
                            <div class="calendar-day">Вт</div>
                            <div class="calendar-day">Ср</div>
                            <div class="calendar-day">Чт</div>
                            <div class="calendar-day">Пт</div>
                            <div class="calendar-day">Сб</div>
                            <div class="calendar-day">Вс</div>
                            
                            <!-- Пример дней -->
                            <div class="calendar-day">30</div>
                            <div class="calendar-day">31</div>
                            <div class="calendar-day">1</div>
                            <div class="calendar-day">2</div>
                            <div class="calendar-day appointment active">3</div>
                            <div class="calendar-day">4</div>
                            <div class="calendar-day">5</div>
                            <!-- Продолжение... -->
                        </div>
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="openAppointmentModal()">
                        <i class="fas fa-plus"></i> Добавить прием
                    </button>
                </div>
                
                <div class="progress-card">
                    <h4><i class="fas fa-file-medical"></i> Медицинские отчеты</h4>
                    <div style="margin-top: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8fafc; border-radius: 10px; margin-bottom: 10px;">
                            <div>
                                <p style="font-weight: 600; color: var(--medical-blue);">Диагностика 15.10.2023</p>
                                <p style="color: var(--medical-gray); font-size: 0.9rem;">Общий результат: 82%</p>
                            </div>
                            <button class="btn btn-secondary" style="padding: 8px 15px;" onclick="downloadReport('diagnostic')">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8fafc; border-radius: 10px; margin-bottom: 10px;">
                            <div>
                                <p style="font-weight: 600; color: var(--medical-blue);">Прогресс за месяц</p>
                                <p style="color: var(--medical-gray); font-size: 0.9rem;">Обновлено: 10.11.2023</p>
                            </div>
                            <button class="btn btn-secondary" style="padding: 8px 15px;" onclick="downloadReport('progress')">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 15px; background: #f8fafc; border-radius: 10px;">
                            <div>
                                <p style="font-weight: 600; color: var(--medical-blue);">План реабилитации</p>
                                <p style="color: var(--medical-gray); font-size: 0.9rem;">Создан: 05.11.2023</p>
                            </div>
                            <button class="btn btn-secondary" style="padding: 8px 15px;" onclick="downloadReport('plan')">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <button class="btn btn-success" style="width: 100%; margin-top: 20px;" onclick="generateFullReport()">
                        <i class="fas fa-file-pdf"></i> Создать полный отчет
                    </button>
                </div>
                
                <div class="progress-card">
                    <h4><i class="fas fa-users"></i> Сообщество поддержки</h4>
                    <div style="margin-top: 20px;">
                        <div style="padding: 20px; background: linear-gradient(135deg, #f8fafc 0%, #e8f4fd 100%); border-radius: 15px; margin-bottom: 20px;">
                            <h5 style="color: var(--medical-blue); margin-bottom: 15px;">Группы поддержки</h5>
                            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                                <span style="background: rgba(13, 152, 186, 0.1); color: var(--medical-cyan); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">Родители</span>
                                <span style="background: rgba(155, 89, 182, 0.1); color: var(--medical-purple); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">Подростки</span>
                                <span style="background: rgba(46, 204, 113, 0.1); color: var(--medical-green); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">Специалисты</span>
                            </div>
                            <button class="btn btn-primary" style="width: 100%;" onclick="openCommunity()">
                                <i class="fas fa-comments"></i> Присоединиться
                            </button>
                        </div>
                        
                        <div style="padding: 20px; background: linear-gradient(135deg, #f8fafc 0%, #e8f4fd 100%); border-radius: 15px;">
                            <h5 style="color: var(--medical-blue); margin-bottom: 15px;">Экспертные вебинары</h5>
                            <p style="color: var(--medical-gray); margin-bottom: 15px;">Еженедельные занятия с нейропсихологами</p>
                            <button class="btn btn-purple" style="width: 100%;" onclick="openWebinars()">
                                <i class="fas fa-video"></i> Расписание вебинаров
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Модальное окно входа/регистрации -->
    <div class="auth-modal" id="authModal">
        <div class="auth-content">
            <button class="close-auth" onclick="closeAuthModal()">✕</button>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Вход</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Регистрация</button>
            </div>
            
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="loginEmail" placeholder="Ваш email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Пароль</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="Ваш пароль" required>
                </div>
                
                <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="rememberMe">
                        <span style="color: var(--medical-gray); font-size: 0.9rem;">Запомнить меня</span>
                    </label>
                    <a href="#" style="color: var(--medical-cyan); font-size: 0.9rem; text-decoration: none;">Забыли пароль?</a>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 16px;">
                    <i class="fas fa-sign-in-alt"></i> Войти в систему
                </button>
                
                <p style="text-align: center; margin-top: 20px; color: var(--medical-gray);">
                    Нет аккаунта? <a href="#" onclick="switchAuthTab('register')" style="color: var(--medical-cyan); font-weight: 600; cursor: pointer;">Зарегистрируйтесь</a>
                </p>
            </form>
            
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label class="form-label">Имя и фамилия</label>
                    <input type="text" class="form-control" id="registerName" placeholder="Ваше имя и фамилия" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" class="form-control" id="registerEmail" placeholder="Ваш email" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Пароль</label>
                    <input type="password" class="form-control" id="registerPassword" placeholder="Придумайте пароль" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Подтвердите пароль</label>
                    <input type="password" class="form-control" id="registerConfirmPassword" placeholder="Повторите пароль" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Дата рождения</label>
                    <input type="date" class="form-control" id="registerBirthDate">
                </div>
                
                <div class="form-group" style="margin-bottom: 30px;">
                    <label class="form-label">Роль</label>
                    <select class="form-control" id="registerRole">
                        <option value="parent">Родитель</option>
                        <option value="specialist">Специалист</option>
                        <option value="patient">Пациент</option>
                    </select>
                </div>
                
                <button type="submit" class="btn btn-success" style="width: 100%; padding: 16px;">
                    <i class="fas fa-user-plus"></i> Зарегистрироваться
                </button>
                
                <p style="text-align: center; margin-top: 20px; color: var(--medical-gray);">
                    Уже есть аккаунт? <a href="#" onclick="switchAuthTab('login')" style="color: var(--medical-cyan); font-weight: 600; cursor: pointer;">Войдите</a>
                </p>
            </form>
        </div>
    </div>

    <!-- Виртуальный помощник ИИ -->
    <div class="ai-assistant">
        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                <h4><i class="fas fa-robot"></i> Нейропсихолог NeuroAI</h4>
                <button class="close-chat" onclick="toggleChat()">✕</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    Здравствуйте! Я ваш виртуальный нейропсихолог. Готов помочь с диагностикой, тренировками и ответить на вопросы о когнитивном развитии.
                    <div class="message-time">Только что</div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Задайте вопрос о когнитивном здоровье..." onkeypress="if(event.key === 'Enter') sendMessage()">
                <button class="send-btn" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
        <button class="chat-toggle" onclick="toggleChat()">
            <i class="fas fa-robot"></i>
            <div class="notification"></div>
        </button>
    </div>

    <!-- Быстрые действия -->
    <div class="quick-actions">
        <button class="quick-btn emergency" onclick="openEmergencyModal()">
            <i class="fas fa-phone-alt"></i>
        </button>
        <button class="quick-btn" onclick="startMemoryGame()">
            <i class="fas fa-brain"></i>
        </button>
        <button class="quick-btn" onclick="openAppointmentModal()">
            <i class="fas fa-calendar-plus"></i>
        </button>
    </div>

    <!-- Модальные окна -->
    <div class="modal" id="appointmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-calendar-alt"></i> Запись на консультацию</h3>
                <button class="close-modal" onclick="closeModal('appointmentModal')">✕</button>
            </div>
            <form id="appointmentForm" style="margin-top: 30px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 8px; color: var(--medical-blue); font-weight: 500;">Выберите специалиста</label>
                        <select class="result-input" style="width: 100%;" id="specialistSelect" required>
                            <option value="">Выберите специалиста</option>
                            <option value="neuropsychologist">Нейропсихолог</option>
                            <option value="neurologist">Детский невролог</option>
                            <option value="psychiatrist">Психиатр</option>
                            <option value="speech_therapist">Логопед-дефектолог</option>
                            <option value="psychologist">Психолог</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 8px; color: var(--medical-blue); font-weight: 500;">Формат консультации</label>
                        <select class="result-input" style="width: 100%;" id="consultationType" required>
                            <option value="">Выберите формат</option>
                            <option value="online">Онлайн консультация</option>
                            <option value="clinic">Прием в клинике</option>
                            <option value="home">Выезд на дом</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 8px; color: var(--medical-blue); font-weight: 500;">Дата приема</label>
                        <input type="date" class="result-input" style="width: 100%;" id="appointmentDate" required>
                    </div>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 8px; color: var(--medical-blue); font-weight: 500;">Время</label>
                        <select class="result-input" style="width: 100%;" id="appointmentTime" required>
                            <option value="">Выберите время</option>
                            <option>09:00</option>
                            <option>10:00</option>
                            <option>11:00</option>
                            <option>12:00</option>
                            <option>14:00</option>
                            <option>15:00</option>
                            <option>16:00</option>
                            <option>17:00</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--medical-blue); font-weight: 500;">Ваше имя</label>
                    <input type="text" class="result-input" style="width: 100%;" id="patientName" required>
                </div>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--medical-blue); font-weight: 500;">Телефон для связи</label>
                    <input type="tel" class="result-input" style="width: 100%;" id="patientPhone" required>
                </div>
                
                <div class="form-group" style="margin-bottom: 30px;">
                    <label style="display: block; margin-bottom: 8px; color: var(--medical-blue); font-weight: 500;">Дополнительная информация</label>
                    <textarea class="result-input" style="width: 100%; height: 100px; resize: vertical;" id="appointmentNotes" placeholder="Опишите проблему, укажите возраст ребенка, предыдущие диагнозы..."></textarea>
                </div>
                
                <button type="submit" class="btn btn-success" style="width: 100%; padding: 16px;">
                    <i class="fas fa-check"></i> Записаться на консультацию
                </button>
            </form>
        </div>
    </div>

    <div class="modal" id="emergencyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-phone-alt"></i> Срочная помощь</h3>
                <button class="close-modal" onclick="closeModal('emergencyModal')">✕</button>
            </div>
            <div style="padding: 30px 0;">
                <div style="text-align: center; margin-bottom: 40px;">
                    <div style="width: 80px; height: 80px; background: var(--gradient-danger); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                        <i class="fas fa-phone-alt" style="color: white; font-size: 2rem;"></i>
                    </div>
                    <h4 style="color: var(--medical-blue); margin-bottom: 10px;">Экстренная связь со специалистом</h4>
                    <p style="color: var(--medical-gray);">В случае острой необходимости вы можете связаться с нашими специалистами</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 15px;">
                        <i class="fas fa-phone" style="color: var(--medical-green); font-size: 1.5rem; margin-bottom: 10px;"></i>
                        <p style="font-weight: 600; color: var(--medical-blue); margin-bottom: 5px;">Телефон горячей линии</p>
                        <p style="color: var(--medical-gray);">+7 777 202 98 11</p>
                        <button class="btn btn-success" style="margin-top: 10px; width: 100%;" onclick="callEmergency()">
                            <i class="fas fa-phone"></i> Позвонить сейчас
                        </button>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: #f8fafc; border-radius: 15px;">
                        <i class="fab fa-telegram" style="color: var(--medical-cyan); font-size: 1.5rem; margin-bottom: 10px;"></i>
                        <p style="font-weight: 600; color: var(--medical-blue); margin-bottom: 5px;">Telegram консультация</p>
                        <p style="color: var(--medical-gray);">@ardakhovv</p>
                        <button class="btn btn-primary" style="margin-top: 10px; width: 100%;" onclick="openTelegram()">
                            <i class="fab fa-telegram"></i> Написать в Telegram
                        </button>
                    </div>
                </div>
                
                <div style="background: #fff8e1; padding: 20px; border-radius: 15px; border-left: 4px solid var(--medical-yellow);">
                    <h5 style="color: var(--medical-blue); margin-bottom: 10px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> Важная информация
                    </h5>
                    <p style="color: var(--medical-gray); font-size: 0.9rem;">
                        В случае угрозы жизни или здоровья немедленно вызывайте скорую помощь по номеру 103.
                        Данная служба предназначена для консультаций по вопросам когнитивного развития.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <a href="#home" class="logo" style="color: white; align-items: flex-start;">
                        <div class="logo-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div>
                            <h1 style="color: white; -webkit-text-fill-color: white;">NeuroAI</h1>
                            <p style="color: rgba(255, 255, 255, 0.8);">Когнитивная диагностика и реабилитация</p>
                        </div>
                    </a>
                    <p style="color: rgba(255, 255, 255, 0.8);">
                        Профессиональная система для диагностики и развития когнитивных функций у детей и подростков
                    </p>
                    <div class="social-links">
                        <a href="https://t.me/ardakhovv" class="social-link" target="_blank">
                            <i class="fab fa-telegram"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-vk"></i>
                        </a>
                        <a href="#" class="social-link">
                            <i class="fab fa-youtube"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-links">
                    <h4>Разделы</h4>
                    <ul>
                        <li><a href="#home"><i class="fas fa-chevron-right"></i> Главная</a></li>
                        <li><a href="#ai-diagnostic"><i class="fas fa-chevron-right"></i> ИИ-Диагностика</a></li>
                        <li><a href="#games"><i class="fas fa-chevron-right"></i> Когнитивные тренировки</a></li>
                        <li><a href="#progress"><i class="fas fa-chevron-right"></i> Отслеживание прогресса</a></li>
                        <li><a href="#" onclick="openAppointmentModal()"><i class="fas fa-chevron-right"></i> Запись к специалисту</a></li>
                    </ul>
                </div>
                
                <div class="contact-info">
                    <h4>Контакты</h4>
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <div>
                            <p style="font-weight: 600;">Email</p>
                            <p>ardakhovs.family@gmail.com</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <div>
                            <p style="font-weight: 600;">Телефон</p>
                            <p>+7 777 202 98 11</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <div>
                            <p style="font-weight: 600;">Адрес</p>
                            <p>Семей, Уалиханова 206</p>
                        </div>
                    </div>
                    <div class="contact-item">
                        <i class="fab fa-telegram"></i>
                        <div>
                            <p style="font-weight: 600;">Telegram</p>
                            <p>@ardakhovv</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 NeuroAI. Все права защищены.</p>
                <p style="margin-top: 10px;">Данный ресурс предназначен для информационной поддержки и не заменяет консультацию медицинского специалиста.</p>
            </div>
        </div>
    </footer>

    <script>
        // ==================== ПОЛНЫЕ ДАННЫЕ ТЕСТОВ ====================
        const testsData = {
            0: [
                { 
                    id: 1, 
                    name: "Шкалы Бейли (BSID-III)", 
                    checks: "Общее психомоторное развитие", 
                    max: 150, 
                    norm: "90–110", 
                    risk: "70–89", 
                    deviation: "< 70", 
                    unit: "DQ баллов",
                    type: "number",
                    parseNorm: { min: 90, max: 110 },
                    parseRisk: { min: 70, max: 89 },
                    parseDeviation: { max: 69 }
                },
                { 
                    id: 2, 
                    name: "ASQ-3", 
                    checks: "Сенсорика, моторика, социализация", 
                    max: 100, 
                    norm: "75–100", 
                    risk: "50–74", 
                    deviation: "< 50", 
                    unit: "% соответствия",
                    type: "percent",
                    parseNorm: { min: 75, max: 100 },
                    parseRisk: { min: 50, max: 74 },
                    parseDeviation: { max: 49 }
                },
                { 
                    id: 3, 
                    name: "M-CHAT-R/F", 
                    checks: "Скрининг РАС", 
                    max: 20, 
                    norm: "0–2", 
                    risk: "3–6", 
                    deviation: "≥ 7", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 0, max: 2 },
                    parseRisk: { min: 3, max: 6 },
                    parseDeviation: { min: 7 }
                },
                { 
                    id: 4, 
                    name: "Тест Денвера II", 
                    checks: "Моторное развитие", 
                    max: 100, 
                    norm: "75–100", 
                    risk: "50–74", 
                    deviation: "< 50", 
                    unit: "% выполнения",
                    type: "percent",
                    parseNorm: { min: 75, max: 100 },
                    parseRisk: { min: 50, max: 74 },
                    parseDeviation: { max: 49 }
                }
            ],
            5: [
                { 
                    id: 1, 
                    name: "NEPSY-II", 
                    checks: "Память, внимание, речь", 
                    max: 20, 
                    norm: "10–12", 
                    risk: "7–9", 
                    deviation: "≤ 6", 
                    unit: "стенов",
                    type: "number",
                    parseNorm: { min: 10, max: 12 },
                    parseRisk: { min: 7, max: 9 },
                    parseDeviation: { max: 6 }
                },
                { 
                    id: 2, 
                    name: "KABC-II", 
                    checks: "Интеллект и обучение", 
                    max: 160, 
                    norm: "90–110", 
                    risk: "80–89", 
                    deviation: "< 80", 
                    unit: "IQ",
                    type: "number",
                    parseNorm: { min: 90, max: 110 },
                    parseRisk: { min: 80, max: 89 },
                    parseDeviation: { max: 79 }
                },
                { 
                    id: 3, 
                    name: "Тест Струпа (детский)", 
                    checks: "Внимание и контроль", 
                    max: 120, 
                    norm: "≤ 60 сек, ≤ 2 ошибки", 
                    risk: "61–75 сек или 3–4 ошибки", 
                    deviation: "> 75 сек или ≥ 5 ошибок", 
                    unit: "сек/ошибки",
                    type: "complex",
                    parseNorm: { maxTime: 60, maxErrors: 2 },
                    parseRisk: { minTime: 61, maxTime: 75, minErrors: 3, maxErrors: 4 },
                    parseDeviation: { minTime: 76, minErrors: 5 }
                },
                { 
                    id: 4, 
                    name: "WPPSI-IV", 
                    checks: "Интеллектуальное развитие", 
                    max: 160, 
                    norm: "90–110", 
                    risk: "80–89", 
                    deviation: "< 80", 
                    unit: "IQ",
                    type: "number",
                    parseNorm: { min: 90, max: 110 },
                    parseRisk: { min: 80, max: 89 },
                    parseDeviation: { max: 79 }
                },
                { 
                    id: 5, 
                    name: "Тест на зрительно-моторную координацию", 
                    checks: "Зрительно-моторная интеграция", 
                    max: 30, 
                    norm: "20–30", 
                    risk: "15–19", 
                    deviation: "< 15", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 20, max: 30 },
                    parseRisk: { min: 15, max: 19 },
                    parseDeviation: { max: 14 }
                },
                { 
                    id: 6, 
                    name: "Тест на кратковременную память", 
                    checks: "Объем памяти", 
                    max: 10, 
                    norm: "6–10", 
                    risk: "4–5", 
                    deviation: "< 4", 
                    unit: "элементов",
                    type: "number",
                    parseNorm: { min: 6, max: 10 },
                    parseRisk: { min: 4, max: 5 },
                    parseDeviation: { max: 3 }
                }
            ],
            10: [
                { 
                    id: 1, 
                    name: "WISC-V", 
                    checks: "Общий интеллект", 
                    max: 160, 
                    norm: "90–110", 
                    risk: "80–89", 
                    deviation: "< 80", 
                    unit: "IQ",
                    type: "number",
                    parseNorm: { min: 90, max: 110 },
                    parseRisk: { min: 80, max: 89 },
                    parseDeviation: { max: 79 }
                },
                { 
                    id: 2, 
                    name: "Тест Струпа", 
                    checks: "Скорость реакции", 
                    max: 120, 
                    norm: "45–60 сек", 
                    risk: "61–75 сек", 
                    deviation: "> 75 сек", 
                    unit: "сек",
                    type: "time",
                    parseNorm: { min: 45, max: 60 },
                    parseRisk: { min: 61, max: 75 },
                    parseDeviation: { min: 76 }
                },
                { 
                    id: 3, 
                    name: "CPT (Тест непрерывной работы)", 
                    checks: "Ошибки внимания", 
                    max: 100, 
                    norm: "0–10 %", 
                    risk: "11–20 %", 
                    deviation: "> 20 %", 
                    unit: "% ошибок",
                    type: "percent",
                    parseNorm: { min: 0, max: 10 },
                    parseRisk: { min: 11, max: 20 },
                    parseDeviation: { min: 21 }
                },
                { 
                    id: 4, 
                    name: "TMT A/B", 
                    checks: "Переключение внимания", 
                    max: 300, 
                    norm: "A ≤ 40, B ≤ 80", 
                    risk: "A 41–60, B 81–100", 
                    deviation: "A > 60, B > 100", 
                    unit: "сек",
                    type: "complex",
                    parseNorm: { maxA: 40, maxB: 80 },
                    parseRisk: { minA: 41, maxA: 60, minB: 81, maxB: 100 },
                    parseDeviation: { minA: 61, minB: 101 }
                },
                { 
                    id: 5, 
                    name: "RAVLT (Список слов)", 
                    checks: "Вербальная память", 
                    max: 15, 
                    norm: "10–15", 
                    risk: "7–9", 
                    deviation: "≤ 6", 
                    unit: "слов",
                    type: "number",
                    parseNorm: { min: 10, max: 15 },
                    parseRisk: { min: 7, max: 9 },
                    parseDeviation: { max: 6 }
                },
                { 
                    id: 6, 
                    name: "Тест на зрительно-пространственные функции", 
                    checks: "Пространственное мышление", 
                    max: 25, 
                    norm: "18–25", 
                    risk: "12–17", 
                    deviation: "< 12", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 18, max: 25 },
                    parseRisk: { min: 12, max: 17 },
                    parseDeviation: { max: 11 }
                },
                { 
                    id: 7, 
                    name: "Тест на фонологическую обработку", 
                    checks: "Речевые функции", 
                    max: 20, 
                    norm: "15–20", 
                    risk: "10–14", 
                    deviation: "< 10", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 15, max: 20 },
                    parseRisk: { min: 10, max: 14 },
                    parseDeviation: { max: 9 }
                },
                { 
                    id: 8, 
                    name: "Тест на рабочую память", 
                    checks: "Рабочая память", 
                    max: 12, 
                    norm: "8–12", 
                    risk: "5–7", 
                    deviation: "< 5", 
                    unit: "элементов",
                    type: "number",
                    parseNorm: { min: 8, max: 12 },
                    parseRisk: { min: 5, max: 7 },
                    parseDeviation: { max: 4 }
                }
            ],
            15: [
                { 
                    id: 1, 
                    name: "WCST (Висконсинский тест)", 
                    checks: "Когнитивная гибкость", 
                    max: 6, 
                    norm: "5–6", 
                    risk: "3–4", 
                    deviation: "≤ 2", 
                    unit: "категорий",
                    type: "number",
                    parseNorm: { min: 5, max: 6 },
                    parseRisk: { min: 3, max: 4 },
                    parseDeviation: { max: 2 }
                },
                { 
                    id: 2, 
                    name: "TMT B", 
                    checks: "Скорость мышления", 
                    max: 180, 
                    norm: "≤ 80", 
                    risk: "81–110", 
                    deviation: "> 110", 
                    unit: "сек",
                    type: "time",
                    parseNorm: { max: 80 },
                    parseRisk: { min: 81, max: 110 },
                    parseDeviation: { min: 111 }
                },
                { 
                    id: 3, 
                    name: "RAVLT", 
                    checks: "Память и обучение", 
                    max: 15, 
                    norm: "10–15", 
                    risk: "7–9", 
                    deviation: "≤ 6", 
                    unit: "слов",
                    type: "number",
                    parseNorm: { min: 10, max: 15 },
                    parseRisk: { min: 7, max: 9 },
                    parseDeviation: { max: 6 }
                },
                { 
                    id: 4, 
                    name: "PHQ-A", 
                    checks: "Депрессивные симптомы", 
                    max: 27, 
                    norm: "0–4", 
                    risk: "5–9", 
                    deviation: "≥ 10", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 0, max: 4 },
                    parseRisk: { min: 5, max: 9 },
                    parseDeviation: { min: 10 }
                },
                { 
                    id: 5, 
                    name: "Тест на исполнительные функции", 
                    checks: "Контроль поведения", 
                    max: 30, 
                    norm: "22–30", 
                    risk: "15–21", 
                    deviation: "< 15", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 22, max: 30 },
                    parseRisk: { min: 15, max: 21 },
                    parseDeviation: { max: 14 }
                },
                { 
                    id: 6, 
                    name: "Тест на социальное познание", 
                    checks: "Социальные навыки", 
                    max: 20, 
                    norm: "15–20", 
                    risk: "10–14", 
                    deviation: "< 10", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 15, max: 20 },
                    parseRisk: { min: 10, max: 14 },
                    parseDeviation: { max: 9 }
                },
                { 
                    id: 7, 
                    name: "Тест на мотивацию достижений", 
                    checks: "Учебная мотивация", 
                    max: 40, 
                    norm: "30–40", 
                    risk: "20–29", 
                    deviation: "< 20", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 30, max: 40 },
                    parseRisk: { min: 20, max: 29 },
                    parseDeviation: { max: 19 }
                }
            ],
            18: [
                { 
                    id: 1, 
                    name: "MoCA", 
                    checks: "Общая когнитивная оценка", 
                    max: 30, 
                    norm: "26–30", 
                    risk: "23–25", 
                    deviation: "< 23", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 26, max: 30 },
                    parseRisk: { min: 23, max: 25 },
                    parseDeviation: { max: 22 }
                },
                { 
                    id: 2, 
                    name: "WAIS-IV", 
                    checks: "Интеллектуальный профиль", 
                    max: 160, 
                    norm: "90–110", 
                    risk: "80–89", 
                    deviation: "< 80", 
                    unit: "IQ",
                    type: "number",
                    parseNorm: { min: 90, max: 110 },
                    parseRisk: { min: 80, max: 89 },
                    parseDeviation: { max: 79 }
                },
                { 
                    id: 3, 
                    name: "Тест Струпа", 
                    checks: "Внимание и самоконтроль", 
                    max: 120, 
                    norm: "≤ 55 сек, ≤ 2 ошибки", 
                    risk: "56–70 сек, 3–4 ошибки", 
                    deviation: "> 70 сек, ≥ 5 ошибок", 
                    unit: "сек/ошибки",
                    type: "complex",
                    parseNorm: { maxTime: 55, maxErrors: 2 },
                    parseRisk: { minTime: 56, maxTime: 70, minErrors: 3, maxErrors: 4 },
                    parseDeviation: { minTime: 71, minErrors: 5 }
                },
                { 
                    id: 4, 
                    name: "GAD-7", 
                    checks: "Тревожность", 
                    max: 21, 
                    norm: "0–4", 
                    risk: "5–9", 
                    deviation: "≥ 10", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 0, max: 4 },
                    parseRisk: { min: 5, max: 9 },
                    parseDeviation: { min: 10 }
                },
                { 
                    id: 5, 
                    name: "BDI-II", 
                    checks: "Депрессия", 
                    max: 63, 
                    norm: "0–13", 
                    risk: "14–19", 
                    deviation: "≥ 20", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 0, max: 13 },
                    parseRisk: { min: 14, max: 19 },
                    parseDeviation: { min: 20 }
                },
                { 
                    id: 6, 
                    name: "Тест на эпизодическую память", 
                    checks: "Долговременная память", 
                    max: 20, 
                    norm: "15–20", 
                    risk: "10–14", 
                    deviation: "< 10", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 15, max: 20 },
                    parseRisk: { min: 10, max: 14 },
                    parseDeviation: { max: 9 }
                },
                { 
                    id: 7, 
                    name: "Тест на когнитивную эластичность", 
                    checks: "Адаптивное мышление", 
                    max: 25, 
                    norm: "18–25", 
                    risk: "12–17", 
                    deviation: "< 12", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 18, max: 25 },
                    parseRisk: { min: 12, max: 17 },
                    parseDeviation: { max: 11 }
                },
                { 
                    id: 8, 
                    name: "Тест на метакогнитивные навыки", 
                    checks: "Самоконтроль мышления", 
                    max: 30, 
                    norm: "22–30", 
                    risk: "15–21", 
                    deviation: "< 15", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 22, max: 30 },
                    parseRisk: { min: 15, max: 21 },
                    parseDeviation: { max: 14 }
                },
                { 
                    id: 9, 
                    name: "Тест на профессиональные предпочтения", 
                    checks: "Профориентация", 
                    max: 50, 
                    norm: "35–50", 
                    risk: "25–34", 
                    deviation: "< 25", 
                    unit: "баллов",
                    type: "number",
                    parseNorm: { min: 35, max: 50 },
                    parseRisk: { min: 25, max: 34 },
                    parseDeviation: { max: 24 }
                }
            ]
        };

        // ==================== СОСТОЯНИЕ ПРИЛОЖЕНИЯ ====================
        const appState = {
            currentUser: null,
            isLoggedIn: false,
            currentAge: 18,
            testResults: {},
            gameProgress: {
                memory: { score: 0, level: 1, progress: 0, sessions: 0 },
                reaction: { score: 0, avgTime: 0, progress: 0, sessions: 0 },
                attention: { score: 0, accuracy: 0, progress: 0, sessions: 0 }
            },
            diagnosticHistory: []
        };

        // ==================== ИНИЦИАЛИЗАЦИЯ ====================
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            loadTestsForAge(18);
            updateGameProgressDisplay();
            setupNavigation();
        });

        function initApp() {
            // Загрузка сохраненных данных
            const savedUser = localStorage.getItem('neuroai_user');
            if (savedUser) {
                appState.currentUser = JSON.parse(savedUser);
                appState.isLoggedIn = true;
                updateAuthButtons();
            }

            // Загрузка прогресса игр
            const savedProgress = localStorage.getItem('neuroai_game_progress');
            if (savedProgress) {
                appState.gameProgress = JSON.parse(savedProgress);
            }

            // Инициализация обработчиков событий
            initEventListeners();
        }

        function setupNavigation() {
            // Навигация по хедеру
            document.querySelectorAll('nav a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Удаляем активный класс у всех ссылок
                    document.querySelectorAll('nav a').forEach(l => l.classList.remove('active'));
                    // Добавляем активный класс текущей ссылке
                    this.classList.add('active');
                    
                    const targetId = this.getAttribute('href').substring(1);
                    
                    if (targetId === 'home') {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    } else {
                        const targetSection = document.getElementById(targetId);
                        if (targetSection) {
                            targetSection.scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                });
            });

            // Кнопки в герое
            document.getElementById('startAiDiagnosticBtn').addEventListener('click', function() {
                const section = document.getElementById('ai-diagnostic');
                section.scrollIntoView({ behavior: 'smooth' });
            });

            document.getElementById('playGamesBtn').addEventListener('click', function() {
                const section = document.getElementById('games');
                section.scrollIntoView({ behavior: 'smooth' });
            });

            document.getElementById('emergencyBtn').addEventListener('click', openEmergencyModal);
        }

        function initEventListeners() {
            // Кнопки авторизации
            document.getElementById('loginBtn').addEventListener('click', openAuthModal);
            document.getElementById('registerBtn').addEventListener('click', openAuthModal);

            // Выбор возраста
            document.querySelectorAll('.age-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.age-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const age = parseInt(this.dataset.age);
                    appState.currentAge = age;
                    loadTestsForAge(age);
                    document.getElementById('aiAnalysis').style.display = 'none';
                });
            });

            // Анализ результатов
            document.getElementById('analyzeBtn').addEventListener('click', analyzeResults);
            document.getElementById('createPlanBtn').addEventListener('click', createRehabilitationPlan);
            document.getElementById('saveResultsBtn').addEventListener('click', saveTestResults);

            // Автозаполнение
            document.querySelector('.btn-secondary[onclick="autoFillSample()"]').addEventListener('click', autoFillSample);

            // Формы авторизации
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
        }

        // ==================== НАВИГАЦИЯ ====================
        function updateAuthButtons() {
            if (appState.isLoggedIn && appState.currentUser) {
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('registerBtn').innerHTML = '<i class="fas fa-user"></i> ' + appState.currentUser.name;
                document.getElementById('registerBtn').onclick = function() {
                    alert('Вы уже вошли как ' + appState.currentUser.name);
                };
            }
        }

        // ==================== АВТОРИЗАЦИЯ ====================
        function openAuthModal() {
            document.getElementById('authModal').classList.add('active');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
        }

        function switchAuthTab(tab) {
            // Переключение табов
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelector('.auth-tab[onclick="switchAuthTab(\'login\')"]').classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelector('.auth-tab[onclick="switchAuthTab(\'register\')"]').classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                alert('Пожалуйста, заполните все поля');
                return;
            }
            
            // В реальном приложении здесь была бы проверка с сервером
            // Для демонстрации создаем пользователя
            appState.currentUser = {
                id: Date.now(),
                name: email.split('@')[0],
                email: email,
                role: 'parent'
            };
            appState.isLoggedIn = true;
            
            localStorage.setItem('neuroai_user', JSON.stringify(appState.currentUser));
            updateAuthButtons();
            
            alert('Вы успешно вошли в систему!');
            closeAuthModal();
            
            // Очищаем форму
            document.getElementById('loginForm').reset();
        }

        function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const birthDate = document.getElementById('registerBirthDate').value;
            const role = document.getElementById('registerRole').value;
            
            if (!name || !email || !password || !confirmPassword) {
                alert('Пожалуйста, заполните все обязательные поля');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Пароли не совпадают');
                return;
            }
            
            if (password.length < 6) {
                alert('Пароль должен содержать минимум 6 символов');
                return;
            }
            
            // В реальном приложении здесь была бы регистрация на сервере
            appState.currentUser = {
                id: Date.now(),
                name: name,
                email: email,
                birthDate: birthDate,
                role: role,
                registered: new Date().toISOString()
            };
            appState.isLoggedIn = true;
            
            localStorage.setItem('neuroai_user', JSON.stringify(appState.currentUser));
            updateAuthButtons();
            
            alert('Регистрация успешно завершена! Добро пожаловать в NeuroAI.');
            closeAuthModal();
            
            // Очищаем форму
            document.getElementById('registerForm').reset();
        }

        // ==================== ТЕСТЫ ====================
        function loadTestsForAge(age) {
            const tableBody = document.getElementById('testsTableBody');
            tableBody.innerHTML = '';
            appState.testResults = {};
            
            const tests = testsData[age];
            if (!tests) return;

            tests.forEach(test => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${test.id}</td>
                    <td>
                        <div class="test-name">${test.name}</div>
                        <small style="color: var(--medical-gray); display: block; margin-top: 5px;">
                            Макс: ${test.max} ${test.unit}
                        </small>
                    </td>
                    <td>${test.checks}</td>
                    <td>
                        <input type="text" 
                               class="result-input" 
                               data-test-id="${test.id}"
                               placeholder="Введите результат"
                               oninput="handleTestInput(${test.id}, this.value, ${age})"
                               onchange="validateTestInput(${test.id}, this.value, ${test.max}, '${test.type}')">
                        <small style="display: block; color: var(--medical-gray); margin-top: 5px;">
                            Норма: ${test.norm}
                        </small>
                    </td>
                    <td>
                        <span class="category-indicator category-waiting" id="category-${test.id}">
                            <i class="fas fa-clock"></i> Ожидание
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Обработка ввода тестов
        window.handleTestInput = function(testId, value, age) {
            appState.testResults[testId] = value;
            
            if (value && value.trim() !== '') {
                const test = testsData[age].find(t => t.id === testId);
                if (test) {
                    let category = determineTestCategory(test, value);
                    updateCategoryIndicator(testId, category);
                }
            } else {
                updateCategoryIndicator(testId, 'waiting');
            }
        };

        // Валидация ввода
        window.validateTestInput = function(testId, value, max, type) {
            if (!value.trim()) return;
            
            // Для комплексных тестов (время/ошибки)
            if (type === 'complex') {
                const parts = value.split('/');
                if (parts.length === 2) {
                    const time = parseFloat(parts[0]);
                    const errors = parseInt(parts[1]);
                    
                    if (isNaN(time) || isNaN(errors)) {
                        alert('Введите время и количество ошибок через слэш (например: 45/2)');
                        document.querySelector(`[data-test-id="${testId}"]`).value = '';
                        return;
                    }
                } else {
                    alert('Для этого теста введите время и ошибки через слэш (например: 45/2)');
                    document.querySelector(`[data-test-id="${testId}"]`).value = '';
                    return;
                }
            }
            
            // Для числовых тестов
            const numValue = parseFloat(value);
            if (isNaN(numValue)) {
                alert('Пожалуйста, введите числовое значение');
                document.querySelector(`[data-test-id="${testId}"]`).value = '';
                return;
            }
            
            if (type !== 'complex' && numValue > max) {
                alert(`Значение не может превышать ${max}`);
                document.querySelector(`[data-test-id="${testId}"]`).value = max;
            }
        };

        // Определение категории теста
        function determineTestCategory(test, inputValue) {
            if (!inputValue.trim()) return 'waiting';
            
            // Для комплексных тестов (время + ошибки)
            if (test.type === 'complex') {
                const parts = inputValue.split('/').map(p => p.trim());
                if (parts.length === 2) {
                    const time = parseFloat(parts[0]);
                    const errors = parseInt(parts[1]);
                    
                    if (!isNaN(time) && !isNaN(errors)) {
                        if (time <= test.parseNorm.maxTime && errors <= test.parseNorm.maxErrors) {
                            return 'normal';
                        } else if ((time >= test.parseRisk.minTime && time <= test.parseRisk.maxTime) ||
                                  (errors >= test.parseRisk.minErrors && errors <= test.parseRisk.maxErrors)) {
                            return 'risk';
                        } else if (time >= test.parseDeviation.minTime || errors >= test.parseDeviation.minErrors) {
                            return 'deviation';
                        }
                    }
                }
                return 'deviation';
            }
            
            // Для обычных числовых тестов
            const value = parseFloat(inputValue);
            if (isNaN(value)) return 'waiting';
            
            if (test.parseNorm.min !== undefined && test.parseNorm.max !== undefined) {
                if (value >= test.parseNorm.min && value <= test.parseNorm.max) return 'normal';
            } else if (test.parseNorm.max !== undefined) {
                if (value <= test.parseNorm.max) return 'normal';
            } else if (test.parseNorm.min !== undefined) {
                if (value >= test.parseNorm.min) return 'normal';
            }
            
            if (test.parseRisk.min !== undefined && test.parseRisk.max !== undefined) {
                if (value >= test.parseRisk.min && value <= test.parseRisk.max) return 'risk';
            } else if (test.parseRisk.max !== undefined) {
                if (value <= test.parseRisk.max) return 'risk';
            } else if (test.parseRisk.min !== undefined) {
                if (value >= test.parseRisk.min) return 'risk';
            }
            
            return 'deviation';
        }

        function updateCategoryIndicator(testId, category) {
            const indicator = document.getElementById(`category-${testId}`);
            if (!indicator) return;
            
            indicator.className = 'category-indicator';
            
            switch(category) {
                case 'normal':
                    indicator.classList.add('category-normal');
                    indicator.innerHTML = '<i class="fas fa-check-circle"></i> Норма';
                    break;
                case 'risk':
                    indicator.classList.add('category-risk');
                    indicator.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Риск';
                    break;
                case 'deviation':
                    indicator.classList.add('category-deviation');
                    indicator.innerHTML = '<i class="fas fa-times-circle"></i> Отклонение';
                    break;
                default:
                    indicator.classList.add('category-waiting');
                    indicator.innerHTML = '<i class="fas fa-clock"></i> Ожидание';
            }
        }

        // ==================== АНАЛИЗ РЕЗУЛЬТАТОВ ====================
        function analyzeResults() {
            const tests = testsData[appState.currentAge];
            let filledTests = 0;
            let totalTests = tests.length;
            
            // Проверка заполнения
            tests.forEach(test => {
                if (appState.testResults[test.id] && appState.testResults[test.id].trim() !== '') {
                    filledTests++;
                }
            });
            
            if (filledTests === 0) {
                alert('Пожалуйста, заполните хотя бы один тест для анализа');
                return;
            }
            
            if (filledTests < totalTests * 0.5) {
                if (!confirm(`Заполнено только ${filledTests} из ${totalTests} тестов. Продолжить анализ?`)) {
                    return;
                }
            }
            
            // Показать загрузку
            document.getElementById('analysisLoading').classList.add('active');
            document.getElementById('aiAnalysis').style.display = 'none';
            
            // Имитация анализа ИИ
            setTimeout(() => {
                performAIanalysis();
                document.getElementById('analysisLoading').classList.remove('active');
                document.getElementById('aiAnalysis').style.display = 'block';
                document.getElementById('aiAnalysis').scrollIntoView({ behavior: 'smooth' });
                
                // Сохранить в историю
                saveToHistory();
            }, 2500);
        }

        function performAIanalysis() {
            const tests = testsData[appState.currentAge];
            let normalCount = 0;
            let riskCount = 0;
            let deviationCount = 0;
            let totalAnalyzed = 0;
            
            // Анализ каждого теста
            tests.forEach(test => {
                const value = appState.testResults[test.id];
                if (value && value.trim() !== '') {
                    totalAnalyzed++;
                    const category = determineTestCategory(test, value);
                    
                    switch(category) {
                        case 'normal': normalCount++; break;
                        case 'risk': riskCount++; break;
                        case 'deviation': deviationCount++; break;
                    }
                }
            });
            
            // Расчет общего результата
            let overallScore = 0;
            let overallCategory = 'normal';
            
            if (totalAnalyzed > 0) {
                overallScore = Math.round((normalCount / totalAnalyzed) * 100);
                
                if (deviationCount > 0) {
                    overallCategory = 'deviation';
                    if (deviationCount >= Math.ceil(totalAnalyzed * 0.3)) {
                        overallScore = Math.max(30, overallScore - deviationCount * 20);
                    }
                } else if (riskCount > 0) {
                    overallCategory = 'risk';
                    overallScore = Math.max(50, overallScore - riskCount * 10);
                }
            }
            
            // Обновление UI
            updateOverallResult(overallScore, overallCategory, normalCount, riskCount, deviationCount, totalAnalyzed);
            generateRecommendations(normalCount, riskCount, deviationCount, totalAnalyzed);
        }

        function updateOverallResult(score, category, normal, risk, deviation, total) {
            // Круг результата
            const scoreCircle = document.getElementById('overallScoreCircle');
            scoreCircle.className = 'score-circle ' + category;
            scoreCircle.querySelector('span').textContent = score + '%';
            
            // Категория
            const categoryIndicator = document.getElementById('overallCategory');
            categoryIndicator.className = 'category-indicator category-' + category;
            categoryIndicator.innerHTML = category === 'normal' ? 
                '<i class="fas fa-check-circle"></i> Норма' :
                category === 'risk' ? 
                '<i class="fas fa-exclamation-triangle"></i> Риск' :
                '<i class="fas fa-times-circle"></i> Отклонение';
            
            // Сводка
            document.getElementById('categorySummary').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div style="text-align: center; padding: 25px; background: rgba(46, 204, 113, 0.1); border-radius: 15px; border: 2px solid rgba(46, 204, 113, 0.2);">
                        <div style="font-size: 2.5rem; font-weight: 800; color: var(--medical-green);">${normal}</div>
                        <div style="color: var(--medical-green); font-weight: 600; margin: 10px 0;">В норме</div>
                        <small style="color: var(--medical-gray);">${total > 0 ? Math.round((normal/total)*100) : 0}% тестов</small>
                    </div>
                    <div style="text-align: center; padding: 25px; background: rgba(243, 156, 18, 0.1); border-radius: 15px; border: 2px solid rgba(243, 156, 18, 0.2);">
                        <div style="font-size: 2.5rem; font-weight: 800; color: var(--medical-yellow);">${risk}</div>
                        <div style="color: var(--medical-yellow); font-weight: 600; margin: 10px 0;">Риск</div>
                        <small style="color: var(--medical-gray);">${total > 0 ? Math.round((risk/total)*100) : 0}% тестов</small>
                    </div>
                    <div style="text-align: center; padding: 25px; background: rgba(231, 76, 60, 0.1); border-radius: 15px; border: 2px solid rgba(231, 76, 60, 0.2);">
                        <div style="font-size: 2.5rem; font-weight: 800; color: var(--medical-red);">${deviation}</div>
                        <div style="color: var(--medical-red); font-weight: 600; margin: 10px 0;">Отклонение</div>
                        <small style="color: var(--medical-gray);">${total > 0 ? Math.round((deviation/total)*100) : 0}% тестов</small>
                    </div>
                </div>
            `;
        }

        function generateRecommendations(normal, risk, deviation, total) {
            let recommendations = '';
            
            if (deviation > 0) {
                recommendations = `
                    <p style="font-size: 1.1rem; margin-bottom: 20px; color: var(--medical-blue);">
                        <strong>Обнаружены значительные отклонения в ${deviation} тестах.</strong> Требуется срочная консультация специалиста.
                    </p>
                    <ul>
                        <li><strong>Немедленно обратитесь к детскому нейропсихологу или неврологу</strong> для комплексного обследования</li>
                        <li>Рекомендуется пройти дополнительную диагностику: ЭЭГ, МРТ головного мозга, консультацию психиатра</li>
                        <li>Начать коррекционные занятия с нейропсихологом 3 раза в неделю</li>
                        <li>Включить в режим дня: когнитивные упражнения, физическую активность, соблюдение режима сна</li>
                        <li>Исключить чрезмерную нагрузку гаджетами (максимум 1 час в день)</li>
                        <li>Обеспечить сбалансированное питание с достаточным количеством омега-3 кислот</li>
                        <li>Повторное тестирование через 1 месяц для оценки динамики</li>
                    </ul>
                    <div style="margin-top: 25px; padding: 20px; background: #ffeaea; border-radius: 10px; border-left: 4px solid var(--medical-red);">
                        <p style="color: var(--medical-red); font-weight: 600; margin: 0;">
                            <i class="fas fa-exclamation-triangle"></i> Важно: Данные результаты не являются диагнозом, но указывают на необходимость профессионального вмешательства.
                        </p>
                    </div>
                `;
           
            } else if (risk > 0) {
                recommendations = `
                    <p style="font-size: 1.1rem; margin-bottom: 20px; color: var(--medical-blue);">
                        <strong>Обнаружены признаки риска в ${risk} тестах.</strong> Рекомендуется профилактическая коррекция.
                    </p>
                    <ul>
                        <li><strong>Запланируйте консультацию нейропсихолога</strong> для углубленной диагностики</li>
                        <li>Начните регулярные когнитивные тренировки 2-3 раза в неделю</li>
                        <li>Включите упражнения на развитие слабых когнитивных функций</li>
                        <li>Организуйте режим дня с достаточным временем для отдыха и сна</li>
                        <li>Увеличьте физическую активность: прогулки, спорт, танцы</li>
                        <li>Развивайте социальные навыки через групповые занятия</li>
                        <li>Мониторинг прогресса через 2 недели тренировок</li>
                    </ul>
                `;
            } else {
                recommendations = `
                    <p style="font-size: 1.1rem; margin-bottom: 20px; color: var(--medical-blue);">
                        <strong>Все когнитивные функции в пределах нормы!</strong> Отличный результат.
                    </p>
                    <ul>
                        <li><strong>Продолжайте профилактические тренировки</strong> 1-2 раза в неделю для поддержания когнитивного здоровья</li>
                        <li>Рекомендуются разнообразные когнитивные упражнения для всестороннего развития</li>
                        <li>Уделяйте внимание развитию социального интеллекта и эмоционального контроля</li>
                        <li>Поддерживайте здоровый образ жизни: сбалансированное питание, регулярный сон, физическая активность</li>
                        <li>Проходите профилактическую диагностику каждые 6 месяцев</li>
                        <li>Рекомендуем участие в развивающих групповых занятиях</li>
                    </ul>
                    <div style="margin-top: 25px; padding: 20px; background: #e8f7f0; border-radius: 10px; border-left: 4px solid var(--medical-green);">
                        <p style="color: var(--medical-green); font-weight: 600; margin: 0;">
                            <i class="fas fa-check-circle"></i> Отличные результаты! Продолжайте заниматься для поддержания когнитивного здоровья.
                        </p>
                    </div>
                `;
            }
            
            document.getElementById('aiRecommendationText').innerHTML = recommendations;
        }

        function saveToHistory() {
            const diagnosticRecord = {
                id: Date.now(),
                date: new Date().toISOString(),
                age: appState.currentAge,
                results: { ...appState.testResults },
                summary: {
                    score: document.getElementById('overallScoreCircle').querySelector('span').textContent,
                    category: document.getElementById('overallCategory').textContent.includes('Норма') ? 'normal' : 
                              document.getElementById('overallCategory').textContent.includes('Риск') ? 'risk' : 'deviation'
                }
            };
            
            appState.diagnosticHistory.push(diagnosticRecord);
            localStorage.setItem('neuroai_diagnostic_history', JSON.stringify(appState.diagnosticHistory));
        }

        // ==================== ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ ====================
        window.showMedicalHelp = function() {
            alert(`Помощь в заполнении тестов:\n\n1. Вводите результаты тестов согласно полученным данным\n2. Для комплексных тестов (например, Струпа) вводите время и ошибки через слэш: 45/2\n3. Значения должны быть числовыми\n4. Система автоматически определит категорию результата\n\nПри возникновении сложностей проконсультируйтесь со специалистом или заполните образец для примера.`);
        };

        window.autoFillSample = function() {
            const tests = testsData[appState.currentAge];
            tests.forEach(test => {
                let sampleValue = '';
                
                // Генерация примерных значений в зависимости от типа теста
                switch(test.type) {
                    case 'number':
                        sampleValue = Math.floor(Math.random() * (test.parseNorm.max - test.parseNorm.min + 1)) + test.parseNorm.min;
                        break;
                    case 'percent':
                        sampleValue = Math.floor(Math.random() * (100 - 75 + 1)) + 75;
                        break;
                    case 'time':
                        sampleValue = Math.floor(Math.random() * (60 - 40 + 1)) + 40;
                        break;
                    case 'complex':
                        sampleValue = `${Math.floor(Math.random() * (60 - 40 + 1)) + 40}/${Math.floor(Math.random() * 3)}`;
                        break;
                }
                
                const input = document.querySelector(`[data-test-id="${test.id}"]`);
                if (input) {
                    input.value = sampleValue;
                    handleTestInput(test.id, sampleValue, appState.currentAge);
                }
            });
            
            alert('Образцы значений успешно заполнены! Вы можете изменить их при необходимости.');
        };

        function saveTestResults() {
            if (!appState.isLoggedIn) {
                alert('Пожалуйста, войдите или зарегистрируйтесь для сохранения результатов');
                openAuthModal();
                return;
            }
            
            if (Object.keys(appState.testResults).length === 0) {
                alert('Нет данных для сохранения');
                return;
            }
            
            const resultsToSave = {
                userId: appState.currentUser.id,
                date: new Date().toISOString(),
                age: appState.currentAge,
                results: appState.testResults
            };
            
            // Сохранение в localStorage
            let savedResults = JSON.parse(localStorage.getItem('neuroai_saved_results') || '[]');
            savedResults.push(resultsToSave);
            localStorage.setItem('neuroai_saved_results', JSON.stringify(savedResults));
            
            alert('Результаты успешно сохранены!');
        }

        // ==================== ИГРЫ ====================
        // ПАМЯТЬ
        let memoryGame = {
            isPlaying: false,
            cards: [],
            flippedCards: [],
            matchedPairs: 0,
            totalPairs: 8,
            timer: null,
            timeLeft: 60,
            score: 0,
            level: 1
        };

        window.startMemoryGame = function() {
            memoryGame.isPlaying = true;
            memoryGame.flippedCards = [];
            memoryGame.matchedPairs = 0;
            memoryGame.timeLeft = 60 - (memoryGame.level - 1) * 10;
            memoryGame.score = 0;
            
            document.getElementById('memoryStartScreen').classList.remove('active');
            document.getElementById('memoryResultScreen').classList.remove('active');
            document.getElementById('memoryGameScreen').classList.add('active');
            
            createMemoryCards();
            updateMemoryDisplay();
            
            // Таймер
            memoryGame.timer = setInterval(() => {
                memoryGame.timeLeft--;
                updateMemoryDisplay();
                
                if (memoryGame.timeLeft <= 0) {
                    endMemoryGame();
                }
            }, 1000);
        };

        function createMemoryCards() {
            const grid = document.getElementById('memoryGrid');
            grid.innerHTML = '';
            
            // Создаем пары карточек
            const symbols = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
            const cardValues = [...symbols, ...symbols];
            
            // Перемешиваем
            cardValues.sort(() => Math.random() - 0.5);
            
            memoryGame.cards = cardValues.map((value, index) => ({
                id: index,
                value: value,
                flipped: false,
                matched: false
            }));
            
            // Создаем HTML карточек
            memoryGame.cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'memory-card';
                cardElement.textContent = '?';
                cardElement.dataset.id = card.id;
                cardElement.dataset.value = card.value;
                cardElement.onclick = () => flipMemoryCard(card.id);
                grid.appendChild(cardElement);
            });
        }

        function flipMemoryCard(cardId) {
            if (!memoryGame.isPlaying) return;
            
            const card = memoryGame.cards.find(c => c.id === cardId);
            if (!card || card.flipped || card.matched || memoryGame.flippedCards.length >= 2) return;
            
            // Переворачиваем карточку
            card.flipped = true;
            const cardElement = document.querySelector(`.memory-card[data-id="${cardId}"]`);
            cardElement.classList.add('flipped');
            cardElement.textContent = card.value;
            
            memoryGame.flippedCards.push(card);
            
            if (memoryGame.flippedCards.length === 2) {
                checkForMatch();
            }
        }

        function checkForMatch() {
            const [card1, card2] = memoryGame.flippedCards;
            
            if (card1.value === card2.value) {
                // Найдена пара
                setTimeout(() => {
                    card1.matched = true;
                    card2.matched = true;
                    
                    document.querySelector(`.memory-card[data-id="${card1.id}"]`).classList.add('matched');
                    document.querySelector(`.memory-card[data-id="${card2.id}"]`).classList.add('matched');
                    
                    memoryGame.matchedPairs++;
                    memoryGame.score += 100 * memoryGame.level;
                    memoryGame.flippedCards = [];
                    
                    updateMemoryDisplay();
                    
                    // Проверка на завершение уровня
                    if (memoryGame.matchedPairs === memoryGame.totalPairs) {
                        memoryGame.level++;
                        memoryGame.score += memoryGame.timeLeft * 10;
                        endMemoryGame();
                    }
                }, 500);
            } else {
                // Не совпало
                setTimeout(() => {
                    card1.flipped = false;
                    card2.flipped = false;
                    
                    document.querySelector(`.memory-card[data-id="${card1.id}"]`).classList.remove('flipped');
                    document.querySelector(`.memory-card[data-id="${card2.id}"]`).textContent = '?';
                    document.querySelector(`.memory-card[data-id="${card2.id}"]`).classList.remove('flipped');
                    document.querySelector(`.memory-card[data-id="${card2.id}"]`).textContent = '?';
                    
                    memoryGame.flippedCards = [];
                }, 1000);
            }
        }

        function updateMemoryDisplay() {
            document.getElementById('memoryScore').textContent = memoryGame.score;
            document.getElementById('memoryTime').textContent = memoryGame.timeLeft;
            document.getElementById('memoryLevel').textContent = memoryGame.level;
            
            document.getElementById('memoryPairsFound').textContent = memoryGame.matchedPairs;
            document.getElementById('memoryTotalPairs').textContent = memoryGame.totalPairs;
            document.getElementById('memoryTimeLeft').textContent = memoryGame.timeLeft;
        }

        window.pauseMemoryGame = function() {
            if (memoryGame.timer) {
                clearInterval(memoryGame.timer);
                memoryGame.timer = null;
                alert('Игра приостановлена. Нажмите "Завершить" для выхода или продолжите играть.');
            }
        };

        window.endMemoryGame = function() {
            memoryGame.isPlaying = false;
            
            if (memoryGame.timer) {
                clearInterval(memoryGame.timer);
            }
            
            // Обновление прогресса
            appState.gameProgress.memory.sessions++;
            appState.gameProgress.memory.score = Math.max(appState.gameProgress.memory.score, memoryGame.score);
            appState.gameProgress.memory.level = memoryGame.level;
            appState.gameProgress.memory.progress = Math.min(100, appState.gameProgress.memory.progress + 5);
            
            saveGameProgress();
            updateGameProgressDisplay();
            
            // Определение результата
            const accuracy = (memoryGame.matchedPairs / memoryGame.totalPairs) * 100;
            let resultText = '';
            let resultClass = '';
            
            if (accuracy >= 90) {
                resultText = 'Отлично!';
                resultClass = 'category-normal';
            } else if (accuracy >= 70) {
                resultText = 'Хорошо!';
                resultClass = 'category-risk';
            } else {
                resultText = 'Попробуйте еще!';
                resultClass = 'category-deviation';
            }
            
            document.getElementById('memoryResultBadge').className = 'category-indicator ' + resultClass;
            document.getElementById('memoryResultBadge').textContent = resultText;
            
            // Показать экран результатов
            document.getElementById('memoryGameScreen').classList.remove('active');
            document.getElementById('memoryResultScreen').classList.add('active');
        };

        // РЕАКЦИЯ
        let reactionGame = {
            isPlaying: false,
            reactionTimes: [],
            currentRound: 0,
            totalRounds: 10,
            timer: null,
            startTime: null
        };

        window.startReactionTest = function() {
            reactionGame.isPlaying = true;
            reactionGame.reactionTimes = [];
            reactionGame.currentRound = 0;
            
            document.getElementById('reactionStartScreen').classList.remove('active');
            document.getElementById('reactionResultScreen').classList.remove('active');
            document.getElementById('reactionGameScreen').classList.add('active');
            
            startNewReactionRound();
        };

        function startNewReactionRound() {
            if (!reactionGame.isPlaying || reactionGame.currentRound >= reactionGame.totalRounds) {
                endReactionTest();
                return;
            }
            
            reactionGame.currentRound++;
            document.getElementById('reactionRoundDisplay').textContent = reactionGame.currentRound;
            
            const target = document.getElementById('reactionTarget');
            target.classList.remove('active', 'clicked');
            target.textContent = 'ЖДИТЕ...';
            target.style.background = 'var(--gradient-purple)';
            
            // Случайная задержка перед появлением мишени
            const delay = Math.random() * 2000 + 1000;
            
            setTimeout(() => {
                if (!reactionGame.isPlaying) return;
                
                target.classList.add('active');
                target.textContent = 'НАЖМИТЕ!';
                target.style.background = 'var(--gradient-success)';
                reactionGame.startTime = Date.now();
            }, delay);
        }

        window.handleReactionClick = function() {
            if (!reactionGame.isPlaying || !reactionGame.startTime) return;
            
            const reactionTime = Date.now() - reactionGame.startTime;
            reactionGame.reactionTimes.push(reactionTime);
            reactionGame.startTime = null;
            
            const target = document.getElementById('reactionTarget');
            target.classList.remove('active');
            target.classList.add('clicked');
            target.textContent = reactionTime + ' мс';
            target.style.background = 'var(--gradient-danger)';
            
            // Обновление отображения
            updateReactionDisplay();
            
            // Следующий раунд через 1.5 секунды
            setTimeout(() => {
                startNewReactionRound();
            }, 1500);
        };

        function updateReactionDisplay() {
            const avgTime = reactionGame.reactionTimes.length > 0 ? 
                Math.round(reactionGame.reactionTimes.reduce((a, b) => a + b) / reactionGame.reactionTimes.length) : 0;
            
            document.getElementById('reactionTimeDisplay').textContent = avgTime;
            document.getElementById('reactionScore').textContent = reactionGame.reactionTimes.length * 100;
            document.getElementById('reactionAvg').textContent = avgTime;
            document.getElementById('reactionRound').textContent = reactionGame.currentRound;
        }

        function endReactionTest() {
            reactionGame.isPlaying = false;
            
            if (reactionGame.timer) {
                clearTimeout(reactionGame.timer);
            }
            
            // Расчет результатов
            const avgTime = reactionGame.reactionTimes.length > 0 ? 
                Math.round(reactionGame.reactionTimes.reduce((a, b) => a + b) / reactionGame.reactionTimes.length) : 0;
            const bestTime = reactionGame.reactionTimes.length > 0 ? 
                Math.min(...reactionGame.reactionTimes) : 0;
            
            document.getElementById('avgReactionResult').textContent = avgTime;
            document.getElementById('bestReactionResult').textContent = bestTime;
            
            // Определение оценки
            let resultText = '';
            let resultClass = '';
            
            if (avgTime <= 250) {
                resultText = 'Отличная реакция!';
                resultClass = 'category-normal';
            } else if (avgTime <= 400) {
                resultText = 'Хорошая реакция!';
                resultClass = 'category-risk';
            } else {
                resultText = 'Нужно тренироваться!';
                resultClass = 'category-deviation';
            }
            
            document.getElementById('reactionResultBadge').className = 'category-indicator ' + resultClass;
            document.getElementById('reactionResultBadge').textContent = resultText;
            
            // Обновление прогресса
            appState.gameProgress.reaction.sessions++;
            appState.gameProgress.reaction.avgTime = appState.gameProgress.reaction.avgTime > 0 ? 
                Math.min(appState.gameProgress.reaction.avgTime, avgTime) : avgTime;
            appState.gameProgress.reaction.progress = Math.min(100, appState.gameProgress.reaction.progress + 5);
            
            saveGameProgress();
            updateGameProgressDisplay();
            
            // Показать экран результатов
            document.getElementById('reactionGameScreen').classList.remove('active');
            document.getElementById('reactionResultScreen').classList.add('active');
        }

        // ВНИМАНИЕ
        let attentionGame = {
            isPlaying: false,
            targets: [],
            found: 0,
            timer: null,
            timeLeft: 30,
            level: 1,
            totalTargets: 3,
            clicks: 0,
            correctClicks: 0
        };

        window.startAttentionTest = function() {
            attentionGame.isPlaying = true;
            attentionGame.found = 0;
            attentionGame.timeLeft = 30 + (attentionGame.level - 1) * 10;
            attentionGame.totalTargets = 3 + Math.floor(attentionGame.level / 2);
            attentionGame.clicks = 0;
            attentionGame.correctClicks = 0;
            
            document.getElementById('attentionStartScreen').classList.remove('active');
            document.getElementById('attentionResultScreen').classList.remove('active');
            document.getElementById('attentionGameScreen').classList.add('active');
            
            createAttentionGrid();
            startAttentionTimer();
        };

        function createAttentionGrid() {
            const grid = document.getElementById('attentionGrid');
            grid.innerHTML = '';
            
            // Количество клеток в зависимости от уровня
            const totalCells = 16 + (attentionGame.level - 1) * 4;
            document.getElementById('attentionTargetCount').textContent = attentionGame.totalTargets;
            document.getElementById('attentionTotalTargets').textContent = attentionGame.totalTargets;
            
            // Создаем клетки
            const cellValues = [];
            for (let i = 0; i < totalCells; i++) {
                cellValues.push(i < attentionGame.totalTargets ? 'target' : 'empty');
            }
            
            // Перемешиваем
            cellValues.sort(() => Math.random() - 0.5);
            
            attentionGame.targets = cellValues;
            
            // Создаем HTML клеток
            cellValues.forEach((value, index) => {
                const cell = document.createElement('div');
                cell.className = 'attention-cell';
                cell.dataset.index = index;
                cell.dataset.type = value;
                
                if (value === 'target') {
                    cell.textContent = '★';
                } else {
                    const randomSymbol = ['○', '□', '△', '◇'][Math.floor(Math.random() * 4)];
                    cell.textContent = randomSymbol;
                }
                
                cell.onclick = () => handleAttentionClick(index);
                grid.appendChild(cell);
            });
        }

        function handleAttentionClick(index) {
            if (!attentionGame.isPlaying) return;
            
            attentionGame.clicks++;
            const cell = document.querySelector(`.attention-cell[data-index="${index}"]`);
            
            if (attentionGame.targets[index] === 'target') {
                // Правильный клик
                attentionGame.correctClicks++;
                attentionGame.found++;
                cell.classList.add('clicked');
                attentionGame.targets[index] = 'found';
                
                // Обновление отображения
                document.getElementById('attentionFound').textContent = attentionGame.found;
                document.getElementById('attentionScore').textContent = attentionGame.found * 100;
                
                // Проверка на завершение
                if (attentionGame.found === attentionGame.totalTargets) {
                    endAttentionGame();
                }
            } else {
                // Неправильный клик
                cell.classList.add('wrong');
                setTimeout(() => {
                    cell.classList.remove('wrong');
                }, 500);
            }
            
            // Обновление точности
            const accuracy = attentionGame.clicks > 0 ? 
                Math.round((attentionGame.correctClicks / attentionGame.clicks) * 100) : 0;
            document.getElementById('attentionAccuracy').textContent = accuracy;
        }

        function startAttentionTimer() {
            updateAttentionTimeDisplay();
            
            attentionGame.timer = setInterval(() => {
                attentionGame.timeLeft--;
                updateAttentionTimeDisplay();
                
                if (attentionGame.timeLeft <= 0) {
                    endAttentionGame();
                }
            }, 1000);
        }

        function updateAttentionTimeDisplay() {
            document.getElementById('attentionTimeLeft').textContent = attentionGame.timeLeft;
        }

        function endAttentionGame() {
            attentionGame.isPlaying = false;
            
            if (attentionGame.timer) {
                clearInterval(attentionGame.timer);
            }
            
            // Расчет результатов
            const accuracy = attentionGame.clicks > 0 ? 
                Math.round((attentionGame.correctClicks / attentionGame.clicks) * 100) : 0;
            
            document.getElementById('attentionAccuracyResult').textContent = accuracy;
            document.getElementById('attentionTimeResult').textContent = 30 - attentionGame.timeLeft;
            
            // Определение оценки
            let resultText = '';
            let resultClass = '';
            
            if (accuracy >= 90) {
                resultText = 'Отличная концентрация!';
                resultClass = 'category-normal';
                attentionGame.level++;
            } else if (accuracy >= 70) {
                resultText = 'Хорошая концентрация!';
                resultClass = 'category-risk';
                if (Math.random() > 0.5) attentionGame.level++;
            } else {
                resultText = 'Требуется тренировка!';
                resultClass = 'category-deviation';
            }
            
            document.getElementById('attentionResultBadge').className = 'category-indicator ' + resultClass;
            document.getElementById('attentionResultBadge').textContent = resultText;
            
            // Обновление прогресса
            appState.gameProgress.attention.sessions++;
            appState.gameProgress.attention.accuracy = Math.max(appState.gameProgress.attention.accuracy, accuracy);
            appState.gameProgress.attention.level = attentionGame.level;
            appState.gameProgress.attention.progress = Math.min(100, appState.gameProgress.attention.progress + 5);
            
            saveGameProgress();
            updateGameProgressDisplay();
            
            // Показать экран результатов
            document.getElementById('attentionGameScreen').classList.remove('active');
            document.getElementById('attentionResultScreen').classList.add('active');
        }

        // ==================== ПРОГРЕСС ====================
        function saveGameProgress() {
            localStorage.setItem('neuroai_game_progress', JSON.stringify(appState.gameProgress));
        }

        function updateGameProgressDisplay() {
            // Память
            document.getElementById('memoryProgress').textContent = appState.gameProgress.memory.progress + '%';
            document.getElementById('memorySessions').textContent = appState.gameProgress.memory.sessions;
            document.getElementById('memoryProgressBar').style.width = appState.gameProgress.memory.progress + '%';
            
            // Реакция
            const reactionProgress = appState.gameProgress.reaction.avgTime > 0 ? 
                Math.max(0, Math.min(100, Math.round((500 - appState.gameProgress.reaction.avgTime) / 5))) : 0;
            appState.gameProgress.reaction.progress = reactionProgress;
            
            document.getElementById('reactionProgress').textContent = reactionProgress + '%';
            document.getElementById('reactionSessions').textContent = appState.gameProgress.reaction.sessions;
            document.getElementById('reactionProgressBar').style.width = reactionProgress + '%';
            
            // Внимание
            document.getElementById('attentionProgress').textContent = appState.gameProgress.attention.progress + '%';
            document.getElementById('attentionSessions').textContent = appState.gameProgress.attention.sessions;
            document.getElementById('attentionProgressBar').style.width = appState.gameProgress.attention.progress + '%';
        }

        // ==================== МОДАЛЬНЫЕ ОКНА ====================
        window.openAppointmentModal = function(specialist) {
            const modal = document.getElementById('appointmentModal');
            modal.classList.add('active');
            
            if (specialist) {
                document.getElementById('specialistSelect').value = specialist;
            }
        };

        window.openEmergencyModal = function() {
            document.getElementById('emergencyModal').classList.add('active');
        };

        window.closeModal = function(modalId) {
            document.getElementById(modalId).classList.remove('active');
        };

        // Обработка формы записи
        document.getElementById('appointmentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!appState.isLoggedIn) {
                alert('Пожалуйста, войдите в систему для записи на консультацию');
                closeModal('appointmentModal');
                openAuthModal();
                return;
            }
            
            const specialist = document.getElementById('specialistSelect').value;
            const consultationType = document.getElementById('consultationType').value;
            const date = document.getElementById('appointmentDate').value;
            const time = document.getElementById('appointmentTime').value;
            const name = document.getElementById('patientName').value;
            const phone = document.getElementById('patientPhone').value;
            
            if (!specialist || !consultationType || !date || !time || !name || !phone) {
                alert('Пожалуйста, заполните все обязательные поля');
                return;
            }
            
            // Сохранение записи
            const appointment = {
                id: Date.now(),
                specialist: specialist,
                type: consultationType,
                date: date,
                time: time,
                patientName: name,
                phone: phone,
                notes: document.getElementById('appointmentNotes').value,
                created: new Date().toISOString()
            };
            
            // Сохранение в localStorage
            let appointments = JSON.parse(localStorage.getItem('neuroai_appointments') || '[]');
            appointments.push(appointment);
            localStorage.setItem('neuroai_appointments', JSON.stringify(appointments));
            
            alert('Запись успешно создана! Наш специалист свяжется с вами для подтверждения.');
            
            // Отправка уведомления в Telegram (в реальном приложении)
            sendTelegramNotification(appointment);
            
            // Закрытие модального окна
            closeModal('appointmentModal');
            this.reset();
        });

        function sendTelegramNotification(appointment) {
            // В реальном приложении здесь будет отправка на сервер
            console.log('Новая запись на консультацию:', appointment);
            
            // Для демонстрации покажем уведомление
            const chatMessages = document.getElementById('chatMessages');
            if (chatMessages) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message ai';
                messageDiv.innerHTML = `
                    ✅ Запись на консультацию успешно создана!<br>
                    <strong>${getSpecialistName(appointment.specialist)}</strong><br>
                    ${formatDate(appointment.date)} в ${appointment.time}<br><br>
                    С вами свяжутся для подтверждения.
                    <div class="message-time">Только что</div>
                `;
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }

        function getSpecialistName(type) {
            const specialists = {
                'neuropsychologist': 'Нейропсихолог',
                'neurologist': 'Детский невролог',
                'psychiatrist': 'Психиатр',
                'speech_therapist': 'Логопед-дефектолог',
                'psychologist': 'Психолог'
            };
            return specialists[type] || 'Специалист';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // ==================== ИИ-АССИСТЕНТ ====================
        window.toggleChat = function() {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.classList.toggle('active');
            
            if (chatWindow.classList.contains('active')) {
                document.getElementById('chatInput').focus();
            }
        };

        window.sendMessage = function() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Добавление сообщения пользователя
            const chatMessages = document.getElementById('chatMessages');
            const userMessageDiv = document.createElement('div');
            userMessageDiv.className = 'message user';
            userMessageDiv.innerHTML = `
                ${message}
                <div class="message-time">${new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}</div>
            `;
            chatMessages.appendChild(userMessageDiv);
            
            // Очистка поля ввода
            input.value = '';
            
            // Ответ ИИ
            setTimeout(() => {
                const aiResponse = generateAIResponse(message);
                const aiMessageDiv = document.createElement('div');
                aiMessageDiv.className = 'message ai';
                aiMessageDiv.innerHTML = `
                    ${aiResponse}
                    <div class="message-time">${new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}</div>
                `;
                chatMessages.appendChild(aiMessageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        };

        function generateAIResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Ответы на частые вопросы
            if (lowerMessage.includes('привет') || lowerMessage.includes('здравствуй')) {
                return 'Здравствуйте! Чем могу помочь?';
            }
            
            if (lowerMessage.includes('памят') || lowerMessage.includes('забыв')) {
                return 'Для тренировки памяти рекомендую упражнение "Когнитивная память" в разделе игр. Регулярные тренировки помогут улучшить кратковременную и долговременную память.';
            }
            
            if (lowerMessage.includes('внимани') || lowerMessage.includes('концентрац')) {
                return 'Упражнение "Концентрация внимания" поможет развить устойчивое внимание. Также рекомендую ограничить отвлекающие факторы во время занятий.';
            }
            
            if (lowerMessage.includes('реакци') || lowerMessage.includes('скорость')) {
                return 'Тест скорости реакции измеряет психомоторную реакцию. Регулярные тренировки помогут улучшить показатели.';
            }
            
            if (lowerMessage.includes('диагностик') || lowerMessage.includes('тест')) {
                return 'В разделе "ИИ-Диагностика" вы можете пройти комплексное нейропсихологическое тестирование. Выберите возрастную группу для подбора соответствующих тестов.';
            }
            
            if (lowerMessage.includes('специалист') || lowerMessage.includes('врач')) {
                return 'Вы можете записаться на консультацию к нейропсихологу, неврологу или другому специалисту. Нажмите кнопку "Запись к специалисту" или воспользуйтесь быстрыми действиями.';
            }
            
            if (lowerMessage.includes('результат') || lowerMessage.includes('оценк')) {
                return 'После прохождения тестов нажмите "Анализировать результаты" для получения подробного анализа от нейропсихолога.';
            }
            
            if (lowerMessage.includes('план') || lowerMessage.includes('реабилитац')) {
                return 'После анализа результатов система предложит индивидуальный план реабилитации и тренировок.';
            }
            
            if (lowerMessage.includes('срочн') || lowerMessage.includes('экстрен')) {
                return 'В случае экстренной ситуации нажмите кнопку "Срочная консультация" или воспользуйтесь красной кнопкой в левом нижнем углу.';
            }
            
            if (lowerMessage.includes('прогресс') || lowerMessage.includes('улучшен')) {
                return 'В разделе "Прогресс" вы можете отслеживать динамику когнитивного развития. Регулярные тренировки и диагностика помогут наблюдать улучшения.';
            }
            
            if (lowerMessage.includes('возраст') || lowerMessage.includes('дет')) {
                return 'Тесты подбираются по возрастным группам: 0-4 года, 5-9 лет, 10-14 лет, 15-17 лет, 18+ лет. Выберите соответствующую группу для точной диагностики.';
            }
            
            // Общий ответ
            const responses = [
                'Понял ваш вопрос. Как нейропсихологический ассистент, рекомендую пройти диагностику для получения персонализированных рекомендаций.',
                'Интересный вопрос! Для точного ответа мне нужно больше информации о ситуации. Можете описать подробнее?',
                'Это важная тема. Рекомендую обсудить ее со специалистом во время консультации.',
                'Для решения этой задачи попробуйте использовать наши когнитивные тренировки. Они разработаны нейропсихологами и доказали свою эффективность.',
                'Ваш вопрос заслуживает внимания. Давайте вместе подберем оптимальное решение на основе ваших индивидуальных особенностей.'
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // ==================== ДОПОЛНИТЕЛЬНЫЕ ФУНКЦИИ ====================
        window.createRehabilitationPlan = function() {
            if (!appState.isLoggedIn) {
                alert('Пожалуйста, войдите в систему для создания плана реабилитации');
                openAuthModal();
                return;
            }
            
            const aiAnalysis = document.getElementById('aiAnalysis');
            if (aiAnalysis.style.display !== 'block') {
                alert('Пожалуйста, сначала проанализируйте результаты тестов');
                return;
            }
            
            const plan = generateRehabilitationPlan();
            
            // Сохранение плана
            const planData = {
                id: Date.now(),
                date: new Date().toISOString(),
                plan: plan,
                basedOnResults: appState.testResults
            };
            
            localStorage.setItem('neuroai_rehabilitation_plan', JSON.stringify(planData));
            
            // Отображение плана
            const planText = `
                <h4 style="color: var(--medical-blue); margin-bottom: 20px;">
                    <i class="fas fa-tasks"></i> Индивидуальный план реабилитации
                </h4>
                <div style="background: #f8fafc; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    ${plan}
                </div>
                <p style="color: var(--medical-green); font-weight: 600;">
                    <i class="fas fa-check-circle"></i> План успешно создан и сохранен! Вы можете скачать его в разделе "Медицинские отчеты".
                </p>
            `;
            
            const modal = document.getElementById('appointmentModal');
            const modalContent = modal.querySelector('.modal-content');
            const originalContent = modalContent.innerHTML;
            
            modalContent.innerHTML = `
                <div class="modal-header">
                    <h3><i class="fas fa-tasks"></i> План реабилитации</h3>
                    <button class="close-modal" onclick="closeModal('appointmentModal')">✕</button>
                </div>
                <div style="padding: 30px 0;">
                    ${planText}
                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button class="btn btn-success" onclick="downloadMedicalReport('plan')" style="flex: 1;">
                            <i class="fas fa-download"></i> Скачать план
                        </button>
                        <button class="btn btn-primary" onclick="document.getElementById('appointmentModal').innerHTML = '${originalContent.replace(/'/g, "\\'")}'" style="flex: 1;">
                            <i class="fas fa-calendar-alt"></i> Запись к специалисту
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
        };

        function generateRehabilitationPlan() {
            const category = document.getElementById('overallCategory').textContent;
            const score = document.getElementById('overallScoreCircle').querySelector('span').textContent;
            
            let plan = '';
            
            if (category.includes('Отклонение')) {
                plan = `
                    <p><strong>ИНТЕНСИВНЫЙ ПЛАН РЕАБИЛИТАЦИИ</strong></p>
                    <p>Общий результат: ${score}</p>
                    
                    <p><strong>Ежедневные занятия (45-60 минут):</strong></p>
                    <ol>
                        <li><strong>Утренний блок (15 мин):</strong> Когнитивная разминка, упражнения на внимание</li>
                        <li><strong>Дневной блок (30 мин):</strong> Интенсивные тренировки памяти и мышления</li>
                        <li><strong>Вечерний блок (15 мин):</strong> Расслабляющие упражнения, рефлексия</li>
                    </ol>
                    
                    <p><strong>Специализированная помощь:</strong></p>
                    <ul>
                        <li>Консультации нейропсихолога: 3 раза в неделю</li>
                        <li>Занятия с логопедом: 2 раза в неделю</li>
                        <li>Физиотерапия: 2 раза в неделю</li>
                        <li>Групповая терапия: 1 раз в неделю</li>
                    </ul>
                    
                    <p><strong>Рекомендации для семьи:</strong></p>
                    <ul>
                        <li>Создать структурированный режим дня</li>
                        <li>Обеспечить спокойную домашнюю обстановку</li>
                        <li>Регулярно отслеживать прогресс в системе</li>
                        <li>Проводить совместные развивающие занятия</li>
                    </ul>
                    
                    <p><strong>Периодичность оценки:</strong> Еженедельный мониторинг, повторная диагностика через 1 месяц.</p>
                `;
            } else if (category.includes('Риск')) {
                plan = `
                    <p><strong>ПРОФИЛАКТИЧЕСКИЙ ПЛАН РАЗВИТИЯ</strong></p>
                    <p>Общий результат: ${score}</p>
                    
                    <p><strong>Регулярные занятия (30-40 минут):</strong></p>
                    <ol>
                        <li><strong>Тренировка внимания:</strong> 10 минут ежедневно</li>
                        <li><strong>Упражнения на память:</strong> 10 минут, 3 раза в неделю</li>
                        <li><strong>Развитие мышления:</strong> 10 минут, 2 раза в неделю</li>
                        <li><strong>Скоростные тренировки:</strong> 10 минут, 2 раза в неделю</li>
                    </ol>
                    
                    <p><strong>Специализированная помощь:</strong></p>
                    <ul>
                        <li>Консультация нейропсихолога: 1 раз в 2 недели</li>
                        <li>Профилактические занятия: 1 раз в неделю</li>
                    </ul>
                    
                    <p><strong>Рекомендации для семьи:</strong></p>
                    <ul>
                        <li>Поддерживать регулярность занятий</li>
                        <li>Поощрять самостоятельные тренировки</li>
                        <li>Создать мотивационную систему</li>
                    </ul>
                    
                    <p><strong>Периодичность оценки:</strong> Контроль прогресса каждые 2 недели.</p>
                `;
            } else {
                plan = `
                    <p><strong>ПЛАН ПОДДЕРЖАНИЯ КОГНИТИВНОГО ЗДОРОВЬЯ</strong></p>
                    <p>Общий результат: ${score}</p>
                    
                    <p><strong>Поддерживающие занятия (20-30 минут):</strong></p>
                    <ol>
                        <li><strong>Разнообразные когнитивные игры:</strong> 15 минут, 3 раза в неделю</li>
                        <li><strong>Тренировка новых навыков:</strong> 15 минут, 2 раза в неделю</li>
                        <li><strong>Развитие творческого мышления:</strong> 15 минут, 1 раз в неделю</li>
                    </ol>
                    
                    <p><strong>Рекомендации:</strong></p>
                    <ul>
                        <li>Профилактические консультации: 1 раз в месяц</li>
                        <li>Участие в развивающих группах</li>
                        <li>Изучение новых хобби и интересов</li>
                    </ul>
                    
                    <p><strong>Периодичность оценки:</strong> Профилактическая диагностика каждые 3-6 месяцев.</p>
                `;
            }
            
            return plan;
        }

        window.downloadMedicalReport = function(type) {
            if (!appState.isLoggedIn) {
                alert('Пожалуйста, войдите в систему для скачивания отчетов');
                openAuthModal();
                return;
            }
            
            let reportContent = '';
            let filename = '';
            
            if (type === 'diagnostic') {
                const score = document.getElementById('overallScoreCircle').querySelector('span').textContent;
                const category = document.getElementById('overallCategory').textContent;
                const recommendations = document.getElementById('aiRecommendationText').innerText;
                
                reportContent = `
                    МЕДИЦИНСКОЕ ЗАКЛЮЧЕНИЕ
                    Система NeuroAI
                    Дата: ${new Date().toLocaleDateString('ru-RU')}
                    
                    ОБЩИЙ РЕЗУЛЬТАТ: ${score} (${category})
                    
                    РЕЗУЛЬТАТЫ ТЕСТОВ:
                    ${Object.entries(appState.testResults).map(([id, value]) => {
                        const test = testsData[appState.currentAge].find(t => t.id == id);
                        return test ? `${test.name}: ${value} ${test.unit}` : '';
                    }).filter(Boolean).join('\n')}
                    
                    РЕКОМЕНДАЦИИ НЕЙРОПСИХОЛОГА:
                    ${recommendations}
                    
                    Примечание: Данное заключение не заменяет консультацию специалиста.
                    Рекомендуется обратиться к профильному врачу для детального обследования.
                `;
                filename = `neuroai_diagnostic_${new Date().toISOString().split('T')[0]}.txt`;
            } else if (type === 'plan') {
                const planData = JSON.parse(localStorage.getItem('neuroai_rehabilitation_plan'));
                if (!planData) {
                    alert('Сначала создайте план реабилитации');
                    return;
                }
                
                reportContent = `
                    ИНДИВИДУАЛЬНЫЙ ПЛАН РЕАБИЛИТАЦИИ
                    Система NeuroAI
                    Дата создания: ${new Date(planData.date).toLocaleDateString('ru-RU')}
                    
                    ${planData.plan.replace(/<[^>]*>/g, '')}
                    
                    План составлен на основе результатов нейропсихологического тестирования.
                    Рекомендуется корректировать программу под руководством специалиста.
                `;
                filename = `neuroai_rehabilitation_plan_${new Date().toISOString().split('T')[0]}.txt`;
            } else {
                reportContent = `
                    ОТЧЕТ О ПРОГРЕССЕ
                    Система NeuroAI
                    Дата: ${new Date().toLocaleDateString('ru-RU')}
                    
                    СТАТИСТИКА ТРЕНИРОВОК:
                    - Тренировки памяти: ${appState.gameProgress.memory.sessions} сессий
                    - Тренировки реакции: ${appState.gameProgress.reaction.sessions} сессий
                    - Тренировки внимания: ${appState.gameProgress.attention.sessions} сессий
                    
                    ОБЩИЙ ПРОГРЕСС:
                    - Память: ${appState.gameProgress.memory.progress}%
                    - Реакция: ${appState.gameProgress.reaction.progress}%
                    - Внимание: ${appState.gameProgress.attention.progress}%
                    
                    Рекомендации к дальнейшим занятиям:
                    Продолжайте регулярные тренировки для поддержания и улучшения когнитивных функций.
                `;
                filename = `neuroai_progress_report_${new Date().toISOString().split('T')[0]}.txt`;
            }
            
            // Создание и скачивание файла
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Отчет успешно скачан!');
        };

        window.generateFullReport = function() {
            alert('Полный отчет генерируется... В реальном приложении здесь будет создание PDF-документа с графиками и подробным анализом.');
        };

        window.openCommunity = function() {
            alert('В реальном приложении здесь будет переход в раздел сообщества поддержки с форумом и группами.');
        };

        window.openWebinars = function() {
            alert('В реальном приложении здесь будет отображение расписания вебинаров с возможностью регистрации.');
        };

        window.callEmergency = function() {
            alert('В реальном приложении будет осуществлен звонок по номеру +7 777 202 98 11\n\nВ демо-версии: Пожалуйста, используйте этот номер для связи в случае необходимости.');
        };

        window.openTelegram = function() {
            window.open('https://t.me/ardakhovv', '_blank');
        };

        // Обработка нажатия Enter в чате
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Инициализация даты в форме записи
        document.getElementById('appointmentDate').min = new Date().toISOString().split('T')[0];
        document.getElementById('appointmentDate').value = new Date(new Date().getTime() + 24 * 60 * 60 * 1000).toISOString().split('T')[0];

        // Плавная прокрутка для всех ссылок
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                if (this.getAttribute('href') === '#') return;
                
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                
                if (targetId === 'home') {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    const targetElement = document.getElementById(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            });
        });

        // Обновление года в футере
        document.querySelector('.copyright p').innerHTML = document.querySelector('.copyright p').innerHTML.replace('2023', new Date().getFullYear());
    </script>
</body>
</html>